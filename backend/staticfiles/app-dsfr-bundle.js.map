{
  "version": 3,
  "sources": ["../src/app-dsfr.ts", "../src/services/api.service.ts", "../src/services/state.service.ts", "../src/eyeTracker.ts", "../src/targetDetector.ts", "../src/distanceEstimator.ts", "../src/testAnalyzer.ts", "../src/components/screens-dsfr.ts"],
  "sourcesContent": ["/**\n * Application Principale - Suivi Oculaire Clinique\n * Version DSFR (Syst\u00E8me de Design de l'\u00C9tat)\n */\n\nimport apiService from './services/api.service';\nimport stateManager from './services/state.service';\nimport { EyeTracker } from './eyeTracker';\nimport { TargetDetector } from './targetDetector';\nimport { DistanceEstimator } from './distanceEstimator';\nimport { TestAnalyzer } from './testAnalyzer';\nimport {\n    renderHomeScreen,\n    renderCalibrationScreen,\n    renderTestScreen,\n    renderResultsScreen,\n    renderStatisticsScreen,\n    renderNavbarContent,\n    renderNotifications,\n} from './components/screens-dsfr';\n\nclass EyeTrackingApp {\n    private eyeTracker: EyeTracker | null = null;\n    private targetDetector: TargetDetector | null = null;\n    private distanceEstimator: DistanceEstimator | null = null;\n    private testAnalyzer: TestAnalyzer | null = null;\n    private testActive = false;\n    private isCalibrating = false;\n    \n    // Stockage des intervals et animations\n    private testInterval: ReturnType<typeof setInterval> | null = null;\n    private animationFrameId: number | null = null;\n\n    constructor() {\n        this.init();\n    }\n\n    /**\n     * Initialise l'application\n     */\n    private async init(): Promise<void> {\n        console.log('\uD83D\uDE80 Initialisation de l\\'application DSFR...');\n\n        // Nettoie les vieux tokens (au cas o\u00F9 la SECRET_KEY a chang\u00E9)\n        const tokenVersion = localStorage.getItem('token_version');\n        const currentVersion = '2.0'; // Incr\u00E9menter quand SECRET_KEY change\n        \n        if (tokenVersion !== currentVersion) {\n            console.log('\uD83D\uDD04 R\u00E9initialisation des tokens...');\n            apiService.logout();\n            localStorage.setItem('token_version', currentVersion);\n        }\n\n        // V\u00E9rifie l'authentification\n        if (apiService.isAuthenticated()) {\n            try {\n                const patientData = await apiService.getPatient();\n                // Convertir les propri\u00E9t\u00E9s snake_case en camelCase\n                const patient = {\n                    id: patientData.id,\n                    username: patientData.user.username,\n                    email: patientData.user.email,\n                    firstName: patientData.user.first_name || '',\n                    lastName: patientData.user.last_name || '',\n                    age: patientData.age || 0\n                };\n                stateManager.setPatient(patient);\n                stateManager.addNotification('\u2713 Connect\u00E9 avec succ\u00E8s!', 'success');\n            } catch (error) {\n                console.error('Erreur de r\u00E9cup\u00E9ration du patient:', error);\n                // Token invalide - nettoyer et laisser l'utilisateur s'identifier\n                apiService.logout();\n                localStorage.removeItem('token_version');\n            }\n        }\n\n        // Initialise les modules eye tracking\n        await this.initializeEyeTracking();\n\n        // Configure les event listeners\n        this.setupEventListeners();\n\n        // Affiche l'\u00E9cran initial\n        this.render();\n\n        // S'abonne aux changements d'\u00E9tat\n        stateManager.subscribe(() => this.render());\n    }\n\n    /**\n     * Initialise les modules de suivi oculaire\n     */\n    private async initializeEyeTracking(): Promise<void> {\n        try {\n            this.eyeTracker = new EyeTracker();\n            // NE PAS initialiser WebGazer ici - on le fera lors de la calibration\n            // await this.eyeTracker.init();\n            \n            this.targetDetector = new TargetDetector(800, 600);\n            this.distanceEstimator = new DistanceEstimator();\n            this.testAnalyzer = new TestAnalyzer();\n\n            console.log('\u2705 Modules eye tracking initialis\u00E9s');\n        } catch (error) {\n            console.error('Erreur lors de l\\'initialisation:', error);\n            stateManager.addNotification(\n                'Erreur: impossible d\\'initialiser le eye tracker',\n                'error'\n            );\n        }\n    }\n\n    /**\n     * Configure les event listeners (appel\u00E9 une seule fois)\n     */\n    private setupEventListeners(): void {\n        // Utiliser la d\u00E9l\u00E9gation d'\u00E9v\u00E9nements pour les formulaires\n        document.addEventListener('submit', (e) => {\n            const form = e.target as HTMLFormElement;\n\n            if (form.id === 'loginForm') {\n                e.preventDefault();\n                this.handleLogin(form);\n            } else if (form.id === 'registerForm') {\n                e.preventDefault();\n                this.handleRegister(form);\n            }\n        }, false);\n    }\n\n    /**\n     * G\u00E8re la connexion\n     */\n    private async handleLogin(form: HTMLFormElement): Promise<void> {\n        try {\n            const username = (form.querySelector('#loginUsername') as HTMLInputElement)\n                .value;\n            const password = (form.querySelector('#loginPassword') as HTMLInputElement)\n                .value;\n\n            const response = await apiService.login(username, password);\n            stateManager.setPatient({\n                id: response.user_id,\n                username: response.username,\n                email: response.email,\n                firstName: response.first_name || '',\n                lastName: response.last_name || '',\n                age: 0,\n            });\n\n            stateManager.addNotification('\u2713 Connexion r\u00E9ussie!', 'success');\n            this.goToScreen('home-screen');\n            form.reset();\n        } catch (error) {\n            stateManager.addNotification(\n                `\u2715 Erreur: ${error instanceof Error ? error.message : 'Erreur inconnue'}`,\n                'error'\n            );\n        }\n    }\n\n    /**\n     * G\u00E8re l'inscription\n     */\n    private async handleRegister(form: HTMLFormElement): Promise<void> {\n        try {\n            const username = (form.querySelector('#regUsername') as HTMLInputElement)\n                .value;\n            const email = (form.querySelector('#regEmail') as HTMLInputElement).value;\n            const password = (form.querySelector('#regPassword') as HTMLInputElement)\n                .value;\n            const firstName = (form.querySelector('#regFirstName') as HTMLInputElement)\n                .value;\n            const lastName = (form.querySelector('#regLastName') as HTMLInputElement)\n                .value;\n            const age = parseInt(\n                (form.querySelector('#regAge') as HTMLInputElement).value\n            );\n\n            const response = await apiService.register(\n                username,\n                email,\n                password,\n                firstName,\n                lastName,\n                age\n            );\n\n            stateManager.setPatient({\n                id: response.user_id,\n                username: response.username,\n                email: response.email,\n                firstName,\n                lastName,\n                age,\n            });\n\n            stateManager.addNotification(\n                '\u2713 Inscription r\u00E9ussie! Bienvenue!',\n                'success'\n            );\n            this.goToScreen('home-screen');\n            form.reset();\n        } catch (error) {\n            stateManager.addNotification(\n                `\u2715 Erreur: ${error instanceof Error ? error.message : 'Erreur inconnue'}`,\n                'error'\n            );\n        }\n    }\n\n    /**\n     * D\u00E9marre la calibration (publique pour \u00EAtre appel\u00E9e depuis le HTML)\n     */\n    async startCalibration(): Promise<void> {\n        if (this.isCalibrating) {\n            stateManager.addNotification('\u26A0\uFE0F Calibration d\u00E9j\u00E0 en cours...', 'warning');\n            return;\n        }\n\n        if (!this.eyeTracker) {\n            stateManager.addNotification('\u26A0\uFE0F Eye tracker non disponible', 'warning');\n            return;\n        }\n\n        this.isCalibrating = true;\n        try {\n            stateManager.addNotification('\uD83D\uDCF9 Veuillez autoriser l\\'acc\u00E8s \u00E0 votre cam\u00E9ra (haute r\u00E9solution)...', 'info');\n            \n            // Demande l'acc\u00E8s \u00E0 la cam\u00E9ra avec haute r\u00E9solution\n            const stream = await navigator.mediaDevices.getUserMedia({\n                video: {\n                    width: { ideal: 1920 },\n                    height: { ideal: 1080 },\n                    facingMode: 'user'\n                }\n            });\n            \n            stateManager.addNotification('\u2713 Cam\u00E9ra autoris\u00E9e!', 'success');\n            \n            // Initialise WebGazer\n            await this.eyeTracker.init();\n            \n            // Masquer le point de regard de WebGazer pendant la calibration\n            const gazePoint = document.getElementById('webgazerGazeDot');\n            if (gazePoint) {\n                gazePoint.style.display = 'none';\n            }\n            \n            stateManager.addNotification('\uD83D\uDC40 Calibration en cours - Fixez les points rouges', 'info');\n            \n            // Lance l'interface de calibration\n            this.runCalibrationUI();\n            \n            // NE PAS arr\u00EAter le stream - WebGazer en a besoin pour continuer le suivi!\n            \n        } catch (error) {\n            const errorMsg = error instanceof Error ? error.message : 'Erreur inconnue';\n            if (errorMsg.includes('NotAllowedError')) {\n                stateManager.addNotification('\u2715 Acc\u00E8s \u00E0 la cam\u00E9ra refus\u00E9', 'error');\n            } else {\n                stateManager.addNotification(`\u2715 Erreur: ${errorMsg}`, 'error');\n            }\n            console.error('Erreur calibration:', error);\n            this.isCalibrating = false;\n            \n            // Arr\u00EAter WebGazer en cas d'erreur\n            if (this.eyeTracker) {\n                this.eyeTracker.stop();\n            }\n        }\n    }\n\n    /**\n     * Interface de calibration interactive\n     */\n    private runCalibrationUI(): void {\n        const calibrationPoints = [\n            { x: 100, y: 100 },\n            { x: window.innerWidth - 100, y: 100 },\n            { x: window.innerWidth / 2, y: window.innerHeight / 2 },\n            { x: 100, y: window.innerHeight - 100 },\n            { x: window.innerWidth - 100, y: window.innerHeight - 100 },\n        ];\n\n        let currentPointIndex = 0;\n\n        // Afficher le point de regard pendant la calibration\n        const gazePoint = document.getElementById('webgazerGazeDot');\n        if (gazePoint) {\n            gazePoint.style.display = 'block';\n        }\n\n        const showNextPoint = async () => {\n            if (currentPointIndex >= calibrationPoints.length) {\n                // Calibration compl\u00E8te\n                if (this.eyeTracker) {\n                    const success = this.eyeTracker.finalizeCalibration();\n                    if (success) {\n                        stateManager.setCalibrationPoints(this.eyeTracker.calibrationPoints as any);\n                        stateManager.addNotification('\u2713 Calibration r\u00E9ussie! Vous pouvez proc\u00E9der au test.', 'success');\n                    } else {\n                        stateManager.addNotification('\u26A0\uFE0F Calibration incompl\u00E8te. R\u00E9essayez.', 'warning');\n                    }\n                }\n                \n                // Nettoyer le point\n                const pointElement = document.getElementById('calibration-point');\n                if (pointElement) {\n                    pointElement.remove();\n                }\n                \n                // Masquer le point de regard apr\u00E8s calibration\n                const gaze = document.getElementById('webgazerGazeDot');\n                if (gaze) {\n                    gaze.style.display = 'none';\n                }\n                \n                this.isCalibrating = false;\n                return;\n            }\n\n            const point = calibrationPoints[currentPointIndex];\n\n            // Cr\u00E9er et afficher le point\n            let pointElement = document.getElementById('calibration-point');\n            if (!pointElement) {\n                pointElement = document.createElement('div');\n                pointElement.id = 'calibration-point';\n                pointElement.style.cssText = `\n                    position: fixed;\n                    width: 30px;\n                    height: 30px;\n                    background: radial-gradient(circle, #e74c3c, #c0392b);\n                    border-radius: 50%;\n                    border: 3px solid white;\n                    box-shadow: 0 0 15px rgba(231, 76, 60, 0.9);\n                    pointer-events: none;\n                    z-index: 9999;\n                    animation: pulse 1s ease-in-out infinite;\n                `;\n                \n                // Ajouter animation CSS si elle n'existe pas\n                if (!document.getElementById('calibration-style')) {\n                    const style = document.createElement('style');\n                    style.id = 'calibration-style';\n                    style.textContent = `\n                        @keyframes pulse {\n                            0%, 100% { transform: scale(1); }\n                            50% { transform: scale(1.2); }\n                        }\n                    `;\n                    document.head.appendChild(style);\n                }\n                \n                document.body.appendChild(pointElement);\n            }\n\n            pointElement.style.left = (point.x - 15) + 'px';\n            pointElement.style.top = (point.y - 15) + 'px';\n            pointElement.style.display = 'block';\n\n            stateManager.addNotification(`Point ${currentPointIndex + 1}/5: Fixez le point rouge`, 'info');\n            console.log(`Calibration point ${currentPointIndex + 1}:`, point);\n\n            // Attendre que WebGazer d\u00E9tecte les yeux avant d'enregistrer\n            let waitAttempts = 0;\n            const maxAttempts = 50; // 5 secondes max (100ms * 50)\n            const waitForGazeData = setInterval(() => {\n                waitAttempts++;\n                \n                if (this.eyeTracker && this.eyeTracker.gazeData) {\n                    // Nous avons des donn\u00E9es de regard\n                    clearInterval(waitForGazeData);\n                    \n                    const success = this.eyeTracker.addCalibrationPoint(point.x, point.y);\n                    console.log('Point enregistr\u00E9:', success);\n                    \n                    stateManager.addCalibrationPoint({ x: point.x, y: point.y });\n                    currentPointIndex++;\n                    showNextPoint();\n                } else if (waitAttempts >= maxAttempts) {\n                    // Timeout - continuer malgr\u00E9 tout\n                    clearInterval(waitForGazeData);\n                    console.warn('Timeout attente donn\u00E9es de regard');\n                    \n                    const success = this.eyeTracker?.addCalibrationPoint(point.x, point.y) ?? false;\n                    console.log('Point enregistr\u00E9 (timeout):', success);\n                    \n                    stateManager.addCalibrationPoint({ x: point.x, y: point.y });\n                    currentPointIndex++;\n                    showNextPoint();\n                }\n            }, 100);\n        };\n\n        showNextPoint();\n    }\n\n    /**\n     * D\u00E9marre un test (publique pour \u00EAtre appel\u00E9e depuis le HTML)\n     */\n    async startTest(): Promise<void> {\n        if (!this.eyeTracker || !this.targetDetector) {\n            stateManager.addNotification('\u26A0\uFE0F Eye tracker non disponible', 'warning');\n            return;\n        }\n\n        // V\u00E9rifier si WebGazer est initialis\u00E9 et a des donn\u00E9es\n        if (!window.webgazer) {\n            stateManager.addNotification('\u26A0\uFE0F WebGazer non initialis\u00E9', 'warning');\n            return;\n        }\n\n        try {\n            // Initialiser le nouvel test\n            stateManager.startNewTest();\n            this.testActive = true;\n            \n            // Mettre \u00E0 jour l'\u00E9cran IMM\u00C9DIATEMENT\n            this.render();\n            \n            // Afficher le point de regard pendant le test\n            setTimeout(() => {\n                const gazePoint = document.getElementById('webgazerGazeDot');\n                if (gazePoint) {\n                    gazePoint.style.display = 'block';\n                }\n            }, 100);\n\n            // Lancer le suivi de l'\u0153il (WebGazer est d\u00E9j\u00E0 init depuis la calibration)\n            this.eyeTracker.startTracking();\n            \n            stateManager.addNotification('\u25B6\uFE0F Test d\u00E9marr\u00E9! Regardez les cibles.', 'success');\n\n            // Initialiser et d\u00E9marrer le dessin des cibles\n            this.startDrawingTargets();\n\n            // Mettre \u00E0 jour les donn\u00E9es du test en temps r\u00E9el\n            const testData = stateManager.getState().currentTest;\n            if (!testData || !testData.startTime) {\n                throw new Error('Test data not initialized');\n            }\n\n            const testStartTime = testData.startTime;\n            \n            // Stocker l'interval pour pouvoir l'arr\u00EAter plus tard\n            this.testInterval = setInterval(() => {\n                if (!this.testActive) {\n                    if (this.testInterval) {\n                        clearInterval(this.testInterval);\n                        this.testInterval = null;\n                    }\n                    return;\n                }\n\n                const currentTime = Date.now();\n                const elapsed = (currentTime - testStartTime) / 1000;\n                \n                // Essayer de r\u00E9cup\u00E9rer la position du regard\n                const gazePos = this.eyeTracker?.getGazePosition();\n                \n                if (gazePos && this.targetDetector) {\n                    // Mettre \u00E0 jour les donn\u00E9es du test avec la position actuelle\n                    stateManager.updateTestData({\n                        gazeX: gazePos.x,\n                        gazeY: gazePos.y,\n                        timestamp: currentTime,\n                    });\n                } else if (!gazePos) {\n                    // D\u00E9boguer: WebGazer ne retourne pas de donn\u00E9es\n                    console.warn('\u26A0\uFE0F Gaze position null - WebGazer peut ne pas avoir de donn\u00E9es');\n                }\n\n                // Mettre \u00E0 jour les \u00E9l\u00E9ments HTML directement (plus rapide que le re-render)\n                const state = stateManager.getState();\n                const test = state.currentTest;\n                \n                const durationEl = document.getElementById('testDuration');\n                if (durationEl) {\n                    durationEl.textContent = elapsed.toFixed(1) + 's';\n                }\n\n                const trackingEl = document.getElementById('testTracking');\n                if (trackingEl && test) {\n                    trackingEl.textContent = (test.trackingPercentage || 0).toFixed(0) + '%';\n                }\n\n                const fixationsEl = document.getElementById('testFixations');\n                if (fixationsEl && test) {\n                    fixationsEl.textContent = (test.fixationCount || 0).toString();\n                }\n\n                // Afficher l'\u00E9tat des yeux\n                const eyeStateEl = document.getElementById('testEyeState');\n                if (eyeStateEl && this.eyeTracker) {\n                    const eyeState = this.eyeTracker.getEyeState();\n                    let stateText = '';\n                    let stateColor = '';\n                    \n                    if (eyeState === 2) {\n                        stateText = '\uD83D\uDC41\uFE0F\uD83D\uDC41\uFE0F Deux yeux';\n                        stateColor = '#10b981'; // Vert\n                    } else if (eyeState === 1) {\n                        stateText = '\uD83D\uDC41\uFE0F Un oeil';\n                        stateColor = '#f59e0b'; // Orange\n                    } else {\n                        stateText = '\u25CF \u25CF Ferm\u00E9s';\n                        stateColor = '#ef4444'; // Rouge\n                    }\n                    eyeStateEl.textContent = stateText;\n                    eyeStateEl.style.color = stateColor;\n                    eyeStateEl.style.fontWeight = 'bold';\n                }\n\n                // Afficher la stabilit\u00E9 du regard\n                const stabilityEl = document.getElementById('testStability');\n                if (stabilityEl && this.eyeTracker) {\n                    const stability = this.eyeTracker.getGazeStability();\n                    stabilityEl.textContent = stability.toFixed(0) + '%';\n                    stabilityEl.style.color = stability > 70 ? '#10b981' : stability > 40 ? '#f59e0b' : '#ef4444';\n                }\n\n                // Afficher la confiance du suivi\n                const confidenceEl = document.getElementById('testConfidence');\n                if (confidenceEl && this.eyeTracker && (this.eyeTracker as any).gazeData) {\n                    const confidence = ((this.eyeTracker as any).gazeData.confidence * 100).toFixed(0);\n                    confidenceEl.textContent = confidence + '%';\n                    confidenceEl.style.color = parseInt(confidence as string) > 80 ? '#10b981' : parseInt(confidence as string) > 60 ? '#f59e0b' : '#ef4444';\n                }\n            }, 100); // Mettre \u00E0 jour tous les 100ms\n\n        } catch (error) {\n            console.error('Erreur au d\u00E9marrage du test:', error);\n            stateManager.addNotification(\n                `\u2715 Erreur: ${error instanceof Error ? error.message : 'Erreur inconnue'}`,\n                'error'\n            );\n            this.testActive = false;\n        }\n    }\n\n    /**\n     * Arr\u00EAte le test (publique pour \u00EAtre appel\u00E9e depuis le HTML)\n     */\n    async stopTest(): Promise<void> {\n        console.log('\uD83D\uDED1 stopTest appel\u00E9 - testActive:', this.testActive);\n        \n        if (!this.testActive) {\n            console.warn('\u26A0\uFE0F Test non actif, impossible d\\'arr\u00EAter');\n            return;\n        }\n\n        // Marquer le test comme inactif imm\u00E9diatement\n        this.testActive = false;\n        \n        // Arr\u00EAter l'interval de mise \u00E0 jour\n        if (this.testInterval) {\n            clearInterval(this.testInterval);\n            this.testInterval = null;\n            console.log('\u2713 Test interval arr\u00EAt\u00E9');\n        }\n        \n        // Arr\u00EAter l'animation des cibles\n        if (this.animationFrameId) {\n            cancelAnimationFrame(this.animationFrameId);\n            this.animationFrameId = null;\n            console.log('\u2713 Animation frame arr\u00EAt\u00E9e');\n        }\n\n        try {\n            // Arr\u00EAter le suivi\n            if (this.eyeTracker) {\n                this.eyeTracker.stopTracking();\n                console.log('\u2713 Eye tracker arr\u00EAt\u00E9');\n            }\n\n            // Masquer le point de regard\n            const gazePoint = document.getElementById('webgazerGazeDot');\n            if (gazePoint) {\n                gazePoint.style.display = 'none';\n            }\n\n            const testData = stateManager.finishCurrentTest();\n            console.log('Test data:', testData);\n            \n            if (testData) {\n                console.log('Soumission du test au backend...');\n                // Soumet le test au backend\n                const result = await apiService.createTest({\n                    duration: testData.totalTime,\n                    gaze_time: testData.gazeTime,\n                    tracking_percentage: testData.trackingPercentage,\n                    fixation_count: testData.fixationCount,\n                    avg_fixation_duration: testData.avgFixationDuration,\n                    gaze_stability: testData.gazeStability,\n                    gaze_consistency: testData.gazeConsistency,\n                    raw_data: testData.rawData,\n                });\n\n                console.log('\u2713 Test enregistr\u00E9:', result);\n                stateManager.addTestResult(result);\n                stateManager.addNotification('\u2713 Test enregistr\u00E9 avec succ\u00E8s!', 'success');\n                \n                // Naviguer vers l'\u00E9cran des r\u00E9sultats\n                this.goToScreen('results-screen');\n                // Re-render apr\u00E8s transition\n                setTimeout(() => this.render(), 100);\n            } else {\n                console.warn('\u26A0\uFE0F Pas de donn\u00E9es de test');\n                stateManager.addNotification('\u26A0\uFE0F Pas de donn\u00E9es de test', 'warning');\n            }\n        } catch (error) {\n            console.error('\u274C Erreur lors de l\\'arr\u00EAt du test:', error);\n            stateManager.addNotification(\n                `\u2715 Erreur: ${error instanceof Error ? error.message : 'Erreur inconnue'}`,\n                'error'\n            );\n        }\n    }\n\n    /**\n     * Charge et affiche les r\u00E9sultats des tests\n     */\n    async loadResults(): Promise<void> {\n        try {\n            stateManager.addNotification('\u23F3 Chargement des r\u00E9sultats...', 'info');\n            const tests = await apiService.getTests();\n            tests.forEach((test) => stateManager.addTestResult(test));\n            this.goToScreen('results-screen');\n        } catch (error) {\n            stateManager.addNotification(\n                `\u2715 Erreur: ${error instanceof Error ? error.message : 'Erreur inconnue'}`,\n                'error'\n            );\n        }\n    }\n\n    /**\n     * Affiche les d\u00E9tails d'un test sp\u00E9cifique\n     */\n    async viewTest(testId: number): Promise<void> {\n        try {\n            const test = await apiService.getTest(testId);\n            console.log('\uD83D\uDCCB D\u00E9tails du test:', test);\n            stateManager.addNotification(`Test #${testId} charg\u00E9`, 'success');\n            // Vous pouvez ajouter ici un \u00E9cran de d\u00E9tails ou un modal\n        } catch (error) {\n            stateManager.addNotification(\n                `\u2715 Erreur: ${error instanceof Error ? error.message : 'Erreur inconnue'}`,\n                'error'\n            );\n        }\n    }\n\n    /**\n     * Exporte un test en PDF\n     */\n    async exportTestPDF(testId: number): Promise<void> {\n        try {\n            stateManager.addNotification('\u23F3 G\u00E9n\u00E9ration du PDF...', 'info');\n            const blob = await apiService.exportTestPDF(testId);\n            this.downloadBlob(blob, `test_${testId}.pdf`);\n            stateManager.addNotification('\u2713 PDF t\u00E9l\u00E9charg\u00E9 avec succ\u00E8s!', 'success');\n        } catch (error) {\n            stateManager.addNotification(\n                `\u2715 Erreur: ${error instanceof Error ? error.message : 'Erreur inconnue'}`,\n                'error'\n            );\n        }\n    }\n\n    /**\n     * Exporte tous les tests en PDF\n     */\n    async exportAllTestsPDF(): Promise<void> {\n        try {\n            stateManager.addNotification('\u23F3 G\u00E9n\u00E9ration du PDF complet...', 'info');\n            const blob = await apiService.exportAllTestsPDF();\n            this.downloadBlob(blob, 'tous_les_tests.pdf');\n            stateManager.addNotification('\u2713 PDF t\u00E9l\u00E9charg\u00E9 avec succ\u00E8s!', 'success');\n        } catch (error) {\n            stateManager.addNotification(\n                `\u2715 Erreur: ${error instanceof Error ? error.message : 'Erreur inconnue'}`,\n                'error'\n            );\n        }\n    }\n\n    /**\n     * Utilitaire pour t\u00E9l\u00E9charger un blob en tant que fichier\n     */\n    private downloadBlob(blob: Blob, filename: string): void {\n        const url = URL.createObjectURL(blob);\n        const link = document.createElement('a');\n        link.href = url;\n        link.download = filename;\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n        URL.revokeObjectURL(url);\n    }\n\n    /**\n     * Navigue vers un \u00E9cran\n     */\n    goToScreen(screenName: string): void {\n        stateManager.setScreen(screenName);\n    }\n\n    /**\n     * D\u00E9connecte l'utilisateur\n     */\n    logout(): void {\n        apiService.logout();\n        stateManager.reset();\n        stateManager.addNotification('\u2713 D\u00E9connect\u00E9!', 'info');\n        this.goToScreen('home-screen');\n    }\n\n    /**\n     * Affiche l'application\n     */\n    private render(): void {\n        const app = document.getElementById('app');\n        const navbarMenu = document.getElementById('navbarMenu');\n        \n        if (!app || !navbarMenu) return;\n\n        const state = stateManager.getState();\n        let screenContent = '';\n\n        // Met \u00E0 jour la navbar\n        navbarMenu.innerHTML = renderNavbarContent();\n\n        // Affiche l'\u00E9cran appropri\u00E9 bas\u00E9 sur currentScreen\n        switch (state.currentScreen) {\n            case 'home-screen':\n                screenContent = renderHomeScreen();\n                break;\n            case 'calibration-screen':\n                screenContent = renderCalibrationScreen();\n                break;\n            case 'test-screen':\n                screenContent = renderTestScreen();\n                break;\n            case 'results-screen':\n                screenContent = renderResultsScreen();\n                break;\n            case 'statistics-screen':\n                screenContent = renderStatisticsScreen();\n                break;\n            default:\n                screenContent = renderHomeScreen();\n        }\n\n        // Efface compl\u00E8tement le contenu pr\u00E9c\u00E9dent et ajoute le nouvel \u00E9cran\n        app.innerHTML = screenContent;\n        \n        // Ajoute les notifications en tant qu'\u00E9l\u00E9ment s\u00E9par\u00E9\n        const notificationsDiv = document.createElement('div');\n        notificationsDiv.style.position = 'fixed';\n        notificationsDiv.style.top = '100px';\n        notificationsDiv.style.right = '20px';\n        notificationsDiv.style.maxWidth = '400px';\n        notificationsDiv.style.zIndex = '1000';\n        notificationsDiv.innerHTML = renderNotifications();\n        app.parentElement?.appendChild(notificationsDiv);\n    }\n\n    /**\n     * D\u00E9marre l'animation des cibles sur le canvas\n     */\n    private startDrawingTargets(): void {\n        const canvas = document.getElementById('testCanvas') as HTMLCanvasElement;\n        if (!canvas) {\n            console.error('\u274C Canvas testCanvas non trouv\u00E9');\n            return;\n        }\n        \n        if (!this.targetDetector) {\n            console.error('\u274C targetDetector non initialis\u00E9');\n            return;\n        }\n\n        const ctx = canvas.getContext('2d');\n        if (!ctx) {\n            console.error('\u274C Impossible d\\'obtenir le contexte du canvas');\n            return;\n        }\n\n        console.log('\u2705 Canvas initialis\u00E9:', {\n            width: canvas.width,\n            height: canvas.height,\n            targetDetectorWidth: (this.targetDetector as any).width,\n            targetDetectorHeight: (this.targetDetector as any).height\n        });\n\n        // Boucle d'animation des cibles\n        const drawFrame = () => {\n            if (!this.testActive) {\n                this.animationFrameId = null;\n                return;\n            }\n\n            // Effacer le canvas\n            ctx.fillStyle = '#ffffff';\n            ctx.fillRect(0, 0, canvas.width, canvas.height);\n\n            // Mettre \u00E0 jour la position de la cible\n            this.targetDetector?.update();\n\n            // Dessiner la cible\n            this.targetDetector?.draw(ctx);\n\n            // Continuer l'animation\n            this.animationFrameId = requestAnimationFrame(drawFrame);\n        };\n\n        console.log('\uD83C\uDFAF D\u00E9marrage du dessin des cibles...');\n        // D\u00E9marrer la boucle d'animation\n        this.animationFrameId = requestAnimationFrame(drawFrame);\n    }\n}\n\n// Lance l'application\nconst app = new EyeTrackingApp();\n\n// Expose \u00E0 la fen\u00EAtre globale pour les onclick HTML\n(window as any).app = app;\n\nexport default app;\n", "/**\n * Service API - Communication avec le backend Django\n * G\u00E8re l'authentification, les requ\u00EAtes et les erreurs\n */\n\nexport interface ApiResponse<T> {\n    success: boolean;\n    data?: T;\n    error?: string;\n    message?: string;\n}\n\nexport interface AuthResponse {\n    access_token: string;\n    refresh_token: string;\n    user_id: number;\n    username: string;\n    email: string;\n    first_name: string;\n    last_name: string;\n    user?: {\n        id: number;\n        username: string;\n        email: string;\n    };\n}\n\nexport interface PatientResponse {\n    id: number;\n    user: {\n        id: number;\n        username: string;\n        email: string;\n        first_name: string;\n        last_name: string;\n    };\n    age: number;\n    created_at: string;\n    updated_at: string;\n}\n\nexport interface TestResult {\n    id: number;\n    patient: number;\n    test_date: string;\n    duration: number;\n    gaze_time: number;\n    tracking_percentage: number;\n    fixation_count: number;\n    avg_fixation_duration: number;\n    result: 'excellent' | 'good' | 'acceptable' | 'poor';\n    raw_data: Record<string, any>;\n}\n\nclass ApiService {\n    private baseUrl: string;\n    private token: string | null = null;\n    private refreshToken: string | null = null;\n    private isRefreshing: boolean = false;\n\n    constructor(baseUrl: string = 'http://localhost:8000') {\n        this.baseUrl = baseUrl;\n        this.loadTokens();\n    }\n\n    /**\n     * Charge les tokens du localStorage\n     */\n    private loadTokens(): void {\n        this.token = localStorage.getItem('access_token');\n        this.refreshToken = localStorage.getItem('refresh_token');\n    }\n\n    /**\n     * Enregistre un nouveau patient\n     */\n    async register(\n        username: string,\n        email: string,\n        password: string,\n        firstName: string,\n        lastName: string,\n        age: number\n    ): Promise<AuthResponse> {\n        return this.post<AuthResponse>('/api/auth/register/', {\n            username,\n            email,\n            password,\n            first_name: firstName,\n            last_name: lastName,\n            age,\n        });\n    }\n\n    /**\n     * Connecte un patient\n     */\n    async login(username: string, password: string): Promise<AuthResponse> {\n        const response = await this.post<AuthResponse>('/api/auth/login/', {\n            username,\n            password,\n        });\n\n        if (response.access_token) {\n            this.token = response.access_token;\n            this.refreshToken = response.refresh_token;\n            localStorage.setItem('access_token', response.access_token);\n            localStorage.setItem('refresh_token', response.refresh_token);\n        }\n\n        return response;\n    }\n\n    /**\n     * Rafra\u00EEchit le token d'acc\u00E8s\n     */\n    private async refreshAccessToken(): Promise<boolean> {\n        if (this.isRefreshing || !this.refreshToken) {\n            return false;\n        }\n\n        this.isRefreshing = true;\n\n        try {\n            const response = await fetch(`${this.baseUrl}/api/auth/refresh/`, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                },\n                body: JSON.stringify({\n                    refresh: this.refreshToken,\n                }),\n            });\n\n            const data = await response.json();\n\n            if (response.ok && data.access_token) {\n                this.token = data.access_token;\n                localStorage.setItem('access_token', data.access_token);\n                this.isRefreshing = false;\n                return true;\n            }\n\n            // Le refresh token est \u00E9galement expir\u00E9\n            this.logout();\n            this.isRefreshing = false;\n            return false;\n        } catch (error) {\n            this.logout();\n            this.isRefreshing = false;\n            return false;\n        }\n    }\n\n    /**\n     * D\u00E9connecte le patient\n     */\n    logout(): void {\n        this.token = null;\n        this.refreshToken = null;\n        localStorage.removeItem('access_token');\n        localStorage.removeItem('refresh_token');\n    }\n\n    /**\n     * R\u00E9cup\u00E8re les donn\u00E9es du patient connect\u00E9\n     */\n    async getPatient(): Promise<PatientResponse> {\n        return this.get<PatientResponse>('/api/patients/me/');\n    }\n\n    /**\n     * Cr\u00E9e un nouveau test de suivi oculaire\n     */\n    async createTest(testData: {\n        duration: number;\n        gaze_time: number;\n        tracking_percentage: number;\n        fixation_count: number;\n        avg_fixation_duration: number;\n        gaze_stability: number;\n        gaze_consistency: number;\n        raw_data: Record<string, any>;\n    }): Promise<TestResult> {\n        return this.post<TestResult>('/api/tests/', testData);\n    }\n\n    /**\n     * R\u00E9cup\u00E8re tous les tests du patient\n     */\n    async getTests(): Promise<TestResult[]> {\n        return this.get<TestResult[]>('/api/tests/');\n    }\n\n    /**\n     * R\u00E9cup\u00E8re un test sp\u00E9cifique\n     */\n    async getTest(testId: number): Promise<TestResult> {\n        return this.get<TestResult>(`/api/tests/${testId}/`);\n    }\n\n    /**\n     * R\u00E9cup\u00E8re les statistiques du patient\n     */\n    async getStatistics(): Promise<any> {\n        return this.get('/api/tests/statistics/');\n    }\n\n    /**\n     * Exporte un test en PDF\n     */\n    async exportTestPDF(testId: number): Promise<Blob> {\n        const response = await fetch(\n            `${this.baseUrl}/api/tests/${testId}/export_pdf/`,\n            {\n                method: 'GET',\n                headers: this.getHeaders(),\n            }\n        );\n\n        if (!response.ok) {\n            throw new Error('Erreur lors de l\\'export PDF');\n        }\n\n        return response.blob();\n    }\n\n    /**\n     * Exporte tous les tests en PDF\n     */\n    async exportAllTestsPDF(): Promise<Blob> {\n        const response = await fetch(\n            `${this.baseUrl}/api/tests/export_all_pdf/`,\n            {\n                method: 'GET',\n                headers: this.getHeaders(),\n            }\n        );\n\n        if (!response.ok) {\n            throw new Error('Erreur lors de l\\'export PDF');\n        }\n\n        return response.blob();\n    }\n\n    /**\n     * Fait une pr\u00E9diction ML sur un test\n     */\n    async predictTest(testData: Record<string, any>): Promise<any> {\n        return this.post('/ml/predict/', testData);\n    }\n\n    /**\n     * Effectue une requ\u00EAte GET\n     */\n    private async get<T = any>(endpoint: string): Promise<T> {\n        const response = await fetch(`${this.baseUrl}${endpoint}`, {\n            method: 'GET',\n            headers: this.getHeaders(),\n        });\n\n        return this.handleResponse<T>(response);\n    }\n\n    /**\n     * Effectue une requ\u00EAte POST\n     */\n    private async post<T = any>(endpoint: string, data: any): Promise<T> {\n        const response = await fetch(`${this.baseUrl}${endpoint}`, {\n            method: 'POST',\n            headers: this.getHeaders(),\n            body: JSON.stringify(data),\n        });\n\n        return this.handleResponse<T>(response);\n    }\n\n    /**\n     * Effectue une requ\u00EAte PUT\n     */\n    // private async put<T = any>(endpoint: string, data: any): Promise<T> {\n    //     const response = await fetch(`${this.baseUrl}${endpoint}`, {\n    //         method: 'PUT',\n    //         headers: this.getHeaders(),\n    //         body: JSON.stringify(data),\n    //     });\n\n    //     return this.handleResponse<T>(response);\n    // }\n\n    /**\n     * Construit les headers de la requ\u00EAte\n     */\n    private getHeaders(): Record<string, string> {\n        const headers: Record<string, string> = {\n            'Content-Type': 'application/json',\n        };\n\n        if (this.token) {\n            headers['Authorization'] = `Bearer ${this.token}`;\n        }\n\n        return headers;\n    }\n\n    /**\n     * G\u00E8re la r\u00E9ponse de l'API\n     */\n    private async handleResponse<T>(response: Response): Promise<T> {\n        const data = await response.json().catch(() => ({}));\n\n        // Si token expir\u00E9 (401), tenter un refresh\n        if (response.status === 401 && !response.url?.includes('/auth/')) {\n            const refreshed = await this.refreshAccessToken();\n            if (refreshed) {\n                // Relancer la requ\u00EAte avec le nouveau token\n                // Note: Ceci est une simplification - dans un cas r\u00E9el, il faudrait\n                // relancer la requ\u00EAte originale\n                console.log('Token rafra\u00EEchi - veuillez r\u00E9essayer');\n                return data as T;\n            }\n        }\n\n        if (!response.ok) {\n            const errorMessage =\n                data.detail ||\n                data.error ||\n                data.message ||\n                `Erreur ${response.status}`;\n            throw new Error(errorMessage);\n        }\n\n        return data as T;\n    }\n\n    /**\n     * V\u00E9rifie si l'utilisateur est authentifi\u00E9\n     */\n    isAuthenticated(): boolean {\n        return !!this.token;\n    }\n\n    /**\n     * Obtient le token actuel\n     */\n    getToken(): string | null {\n        return this.token;\n    }\n}\n\nexport default new ApiService();\n", "/**\n * Service de gestion d'\u00E9tat global\n * Centralise et persiste l'\u00E9tat de l'application\n */\n\nexport interface Patient {\n    id: number;\n    username: string;\n    email: string;\n    firstName: string;\n    lastName: string;\n    age: number;\n}\n\nexport interface TestData {\n    startTime: number | null;\n    endTime: number | null;\n    totalTime: number;\n    gazeTime: number;\n    trackingPercentage: number;\n    fixationCount: number;\n    avgFixationDuration: number;\n    gazeStability: number;\n    gazeConsistency: number;\n    rawData: Record<string, any>;\n}\n\nexport interface AppState {\n    // Authentification\n    isAuthenticated: boolean;\n    patient: Patient | null;\n\n    // Navigation\n    currentScreen: string;\n\n    // Calibration\n    calibrationPoints: Array<{ x: number; y: number }>;\n    isCalibrated: boolean;\n\n    // Test en cours\n    currentTest: TestData | null;\n\n    // R\u00E9sultats\n    testResults: any[];\n    statistics: any | null;\n\n    // Notifications\n    notifications: Array<{\n        id: string;\n        type: 'success' | 'error' | 'info' | 'warning';\n        message: string;\n        timestamp: number;\n    }>;\n}\n\nclass StateManager {\n    private state: AppState;\n    private subscribers: Set<(state: AppState) => void> = new Set();\n\n    constructor() {\n        this.state = this.initializeState();\n        this.loadState();\n    }\n\n    /**\n     * Initialise l'\u00E9tat par d\u00E9faut\n     */\n    private initializeState(): AppState {\n        return {\n            isAuthenticated: false,\n            patient: null,\n            currentScreen: 'home-screen',\n            calibrationPoints: [],\n            isCalibrated: false,\n            currentTest: null,\n            testResults: [],\n            statistics: null,\n            notifications: [],\n        };\n    }\n\n    /**\n     * Charge l'\u00E9tat depuis localStorage\n     */\n    private loadState(): void {\n        try {\n            const saved = localStorage.getItem('app_state');\n            if (saved) {\n                const parsed = JSON.parse(saved);\n                this.state = { ...this.state, ...parsed };\n            }\n        } catch (error) {\n            console.error('Erreur lors du chargement de l\\'\u00E9tat:', error);\n        }\n    }\n\n    /**\n     * Sauvegarde l'\u00E9tat dans localStorage\n     */\n    private saveState(): void {\n        try {\n            localStorage.setItem('app_state', JSON.stringify(this.state));\n        } catch (error) {\n            console.error('Erreur lors de la sauvegarde de l\\'\u00E9tat:', error);\n        }\n    }\n\n    /**\n     * S'abonne aux changements d'\u00E9tat\n     */\n    subscribe(callback: (state: AppState) => void): () => void {\n        this.subscribers.add(callback);\n        return () => this.subscribers.delete(callback);\n    }\n\n    /**\n     * Notifie tous les abonn\u00E9s\n     */\n    private notify(): void {\n        this.saveState();\n        this.subscribers.forEach((callback) => callback(this.state));\n    }\n\n    /**\n     * Obtient l'\u00E9tat actuel\n     */\n    getState(): AppState {\n        return { ...this.state };\n    }\n\n    /**\n     * D\u00E9finit le patient connect\u00E9\n     */\n    setPatient(patient: Patient | null): void {\n        this.state.patient = patient;\n        this.state.isAuthenticated = !!patient;\n        this.notify();\n    }\n\n    /**\n     * Navigue vers un \u00E9cran\n     */\n    setScreen(screenName: string): void {\n        this.state.currentScreen = screenName;\n        this.notify();\n    }\n\n    /**\n     * Enregistre les points de calibration\n     */\n    setCalibrationPoints(points: Array<{ x: number; y: number }>): void {\n        this.state.calibrationPoints = points;\n        this.state.isCalibrated = points.length >= 5;\n        this.notify();\n    }\n\n    /**\n     * Ajoute un point de calibration\n     */\n    addCalibrationPoint(point: { x: number; y: number }): void {\n        this.state.calibrationPoints.push(point);\n        this.state.isCalibrated = this.state.calibrationPoints.length >= 5;\n        this.notify();\n    }\n\n    /**\n     * D\u00E9marre un nouveau test\n     */\n    startNewTest(): void {\n        this.state.currentTest = {\n            startTime: Date.now(),\n            endTime: null,\n            totalTime: 0,\n            gazeTime: 0,\n            trackingPercentage: 0,\n            fixationCount: 0,\n            avgFixationDuration: 0,\n            gazeStability: 0,\n            gazeConsistency: 0,\n            rawData: {},\n        };\n        this.notify();\n    }\n\n    /**\n     * Met \u00E0 jour les donn\u00E9es du test en cours\n     */\n    updateCurrentTest(testData: Partial<TestData>): void {\n        if (this.state.currentTest) {\n            this.state.currentTest = {\n                ...this.state.currentTest,\n                ...testData,\n            };\n            this.notify();\n        }\n    }\n\n    /**\n     * Met \u00E0 jour les donn\u00E9es du test avec les donn\u00E9es de regard\n     */\n    updateTestData(gazeData: { gazeX: number; gazeY: number; timestamp: number }): void {\n        if (this.state.currentTest) {\n            // Mettre \u00E0 jour le temps total du test\n            const elapsed = (gazeData.timestamp - (this.state.currentTest.startTime || 0)) / 1000;\n            this.state.currentTest.totalTime = elapsed;\n\n            // Enregistrer les donn\u00E9es brutes\n            if (!this.state.currentTest.rawData) {\n                this.state.currentTest.rawData = {};\n            }\n            this.state.currentTest.rawData[gazeData.timestamp] = {\n                x: gazeData.gazeX,\n                y: gazeData.gazeY,\n            };\n\n            // Calculer le nombre de fixations\n            // Une fixation est un groupe de points de regard proches\n            const rawArray = Object.values(this.state.currentTest.rawData) as any[];\n            if (rawArray.length > 0) {\n                let fixationCount = 0;\n                let lastFixationX = rawArray[0].x;\n                let lastFixationY = rawArray[0].y;\n                const fixationThreshold = 100; // pixels\n\n                for (let i = 1; i < rawArray.length; i++) {\n                    const dx = rawArray[i].x - lastFixationX;\n                    const dy = rawArray[i].y - lastFixationY;\n                    const distance = Math.sqrt(dx * dx + dy * dy);\n\n                    if (distance > fixationThreshold) {\n                        fixationCount++;\n                        lastFixationX = rawArray[i].x;\n                        lastFixationY = rawArray[i].y;\n                    }\n                }\n\n                this.state.currentTest.fixationCount = Math.max(1, fixationCount);\n            }\n\n            // Simuler des calculs de tracking\n            this.state.currentTest.trackingPercentage = Math.min(\n                100,\n                (Object.keys(this.state.currentTest.rawData).length / (elapsed * 10)) * 100\n            );\n\n            this.notify();\n        }\n    }\n\n    /**\n     * Termine le test en cours\n     */\n    finishCurrentTest(): TestData | null {\n        if (this.state.currentTest) {\n            this.state.currentTest.endTime = Date.now();\n            this.state.currentTest.totalTime =\n                (this.state.currentTest.endTime -\n                    (this.state.currentTest.startTime || 0)) /\n                1000;\n\n            const test = this.state.currentTest;\n            this.state.currentTest = null;\n            this.notify();\n            return test;\n        }\n        return null;\n    }\n\n    /**\n     * Ajoute un test aux r\u00E9sultats\n     */\n    addTestResult(result: any): void {\n        this.state.testResults.unshift(result);\n        this.notify();\n    }\n\n    /**\n     * D\u00E9finit les statistiques\n     */\n    setStatistics(stats: any): void {\n        this.state.statistics = stats;\n        this.notify();\n    }\n\n    /**\n     * Ajoute une notification\n     */\n    addNotification(\n        message: string,\n        type: 'success' | 'error' | 'info' | 'warning' = 'info'\n    ): string {\n        const id = `notif-${Date.now()}`;\n        this.state.notifications.push({\n            id,\n            type,\n            message,\n            timestamp: Date.now(),\n        });\n\n        // Supprime les notifications apr\u00E8s 5 secondes\n        setTimeout(() => {\n            this.state.notifications = this.state.notifications.filter(\n                (n) => n.id !== id\n            );\n            this.notify();\n        }, 5000);\n\n        this.notify();\n        return id;\n    }\n\n    /**\n     * R\u00E9initialise l'\u00E9tat\n     */\n    reset(): void {\n        this.state = this.initializeState();\n        localStorage.removeItem('app_state');\n        this.notify();\n    }\n}\n\nexport default new StateManager();\n", "/**\n * Module de suivi oculaire professionnel avec WebGazer\n * Haute pr\u00E9cision avec filtres Kalman et lissage avanc\u00E9\n */\n\ninterface Eye {\n    x: number;\n    y: number;\n    area?: number;\n    open?: boolean;\n    confidence?: number;\n}\n\ninterface GazeData {\n    x: number;\n    y: number;\n    timestamp: number;\n    leftEye: Eye | null;\n    rightEye: Eye | null;\n    confidence: number;\n}\n\ninterface CalibrationPoint {\n    screenX: number;\n    screenY: number;\n    gazeX: number;\n    gazeY: number;\n}\n\n// Filtre Kalman simple pour lissage des donn\u00E9es\nclass KalmanFilter {\n    q: number; // Processus bruit\n    r: number; // Bruit de mesure\n    x: number; // Valeur estim\u00E9e\n    p: number; // Incertitude estim\u00E9e\n    k: number; // Gain Kalman\n\n    constructor(initialValue: number, processNoise: number = 0.01, measurementNoise: number = 4) {\n        this.x = initialValue;\n        this.p = 1;\n        this.q = processNoise;\n        this.r = measurementNoise;\n        this.k = 0;\n    }\n\n    update(measurement: number): number {\n        // Pr\u00E9diction\n        this.p = this.p + this.q;\n\n        // Mise \u00E0 jour\n        this.k = this.p / (this.p + this.r);\n        this.x = this.x + this.k * (measurement - this.x);\n        this.p = (1 - this.k) * this.p;\n\n        return this.x;\n    }\n}\n\ndeclare global {\n    interface Window {\n        webgazer: any;\n        onGazeUpdate?: (data: GazeData) => void;\n    }\n}\n\nexport class EyeTracker {\n    isCalibrated: boolean = false;\n    gazeData: GazeData | null = null;\n    previousGazeData: GazeData | null = null;\n    calibrationPoints: CalibrationPoint[] = [];\n    isTracking: boolean = false;\n    eyeOpenThreshold: number = 0.3;\n    \n    // Filtres Kalman pour lissage\n    private kalmanX: KalmanFilter = new KalmanFilter(0);\n    private kalmanY: KalmanFilter = new KalmanFilter(0);\n    \n    // Historique pour calculs avanc\u00E9s\n    private gazeHistory: Array<{ x: number; y: number; timestamp: number }> = [];\n    private maxHistorySize: number = 50;\n    \n    // D\u00E9tection des yeux\n    private leftEyeOpenCount: number = 0;\n    private rightEyeOpenCount: number = 0;\n    private eyeStateBuffer: number = 5;\n\n    /**\n     * Initialise WebGazer avec affichage de la vid\u00E9o\n     */\n    async init(): Promise<void> {\n        return new Promise((resolve, reject) => {\n            console.log('\uD83D\uDE80 Initialisation de WebGazer...');\n            console.log('\uD83D\uDCF9 V\u00E9rification de la disponibilit\u00E9 de la cam\u00E9ra...');\n            \n            // V\u00E9rifier la disponibilit\u00E9 de la cam\u00E9ra d'abord\n            navigator.mediaDevices\n                .enumerateDevices()\n                .then(devices => {\n                    const cameras = devices.filter(device => device.kind === 'videoinput');\n                    console.log(`\uD83D\uDCF7 Cam\u00E9ras d\u00E9tect\u00E9es: ${cameras.length}`);\n                    cameras.forEach((camera, idx) => {\n                        console.log(`  ${idx + 1}. ${camera.label || 'Cam\u00E9ra sans label'}`);\n                    });\n                    \n                    if (cameras.length === 0) {\n                        console.error('\u274C Aucune cam\u00E9ra trouv\u00E9e');\n                        reject(new Error('Cam\u00E9ra non trouv\u00E9e'));\n                        return;\n                    }\n                    \n                    console.log('\u2705 Cam\u00E9ra d\u00E9tect\u00E9e');\n                    \n                    // V\u00E9rifier que WebGazer est charg\u00E9\n                    if (!window.webgazer) {\n                        console.error('\u274C WebGazer non charg\u00E9');\n                        reject(new Error('WebGazer non charg\u00E9'));\n                        return;\n                    }\n                    \n                    console.log('\u2705 WebGazer d\u00E9tect\u00E9');\n                    \n                    // Initialiser WebGazer\n                    console.log('\uD83D\uDD04 Configuration du tracker TFFacemesh...');\n                    \n                    // Configurer le container pour WebGazer\n                    const container = document.getElementById('webgazerVideoContainer') as HTMLElement;\n                    if (container) {\n                        console.log('\u2705 Container WebGazer trouv\u00E9');\n                    }\n                    \n                    window.webgazer\n                        .setRegression('ridge')\n                        .setTracker('TFFacemesh')\n                        .begin()\n                        .then(() => {\n                            console.log('\u2705 WebGazer.begin() compl\u00E9t\u00E9');\n                            \n                            // Force le container WebGazer \u00E0 utiliser le n\u00F4tre\n                            const webgazerContainer = document.querySelector('.webgazer-container') as HTMLElement;\n                            if (webgazerContainer && container) {\n                                console.log('\uD83D\uDCE6 D\u00E9placement du container WebGazer...');\n                                container.appendChild(webgazerContainer);\n                            }\n                            \n                            // Afficher la vid\u00E9o de la cam\u00E9ra\n                            this.showWebcamVideo();\n                            this.setupGazeListener();\n                            \n                            // Attendre que les donn\u00E9es de regard arrivent\n                            let attempts = 0;\n                            const maxAttempts = 100; // 10 secondes (100ms * 100)\n                            console.log(`\u23F3 Attente des donn\u00E9es de regard (max ${maxAttempts * 100}ms)...`);\n                            \n                            const waitForData = setInterval(() => {\n                                attempts++;\n                                \n                                if (this.gazeData) {\n                                    clearInterval(waitForData);\n                                    console.log(`\u2705 Donn\u00E9es de regard re\u00E7ues apr\u00E8s ${attempts * 100}ms`);\n                                    resolve();\n                                } else if (attempts % 10 === 0) {\n                                    console.log(`  ... en attente (${attempts * 100}ms \u00E9coul\u00E9es)`);\n                                }\n                                \n                                if (attempts >= maxAttempts) {\n                                    clearInterval(waitForData);\n                                    console.warn('\u26A0\uFE0F Timeout attente donn\u00E9es de regard - continuant malgr\u00E9 tout');\n                                    resolve(); // Continuer de toute mani\u00E8re\n                                }\n                            }, 100);\n                        })\n                        .catch((error: any) => {\n                            console.error('\u274C Erreur WebGazer:', error);\n                            reject(error);\n                        });\n                })\n                .catch((error: any) => {\n                    console.error('\u274C Erreur acc\u00E8s cam\u00E9ra:', error);\n                    reject(error);\n                });\n        });\n    }\n\n    /**\n     * Affiche la vid\u00E9o de la cam\u00E9ra\n     */\n    private showWebcamVideo(): void {\n        console.log('\uD83D\uDCF9 Initialisation du container vid\u00E9o...');\n        \n        const container = document.getElementById('webgazerVideoContainer') as HTMLElement;\n        if (!container) {\n            console.error('\u274C Container #webgazerVideoContainer non trouv\u00E9 dans le DOM');\n            return;\n        }\n\n        // Afficher le container\n        container.style.display = 'block';\n        container.style.position = 'fixed';\n        container.style.top = '10px';\n        container.style.right = '10px';\n        container.style.width = '200px';\n        container.style.height = '150px';\n        container.style.borderRadius = '10px';\n        container.style.border = '3px solid #10b981';\n        container.style.zIndex = '99998';\n        container.style.boxShadow = '0 4px 15px rgba(16, 185, 129, 0.4)';\n        container.style.background = '#000';\n        container.style.overflow = 'hidden';\n        \n        console.log('\u2705 Conteneur vid\u00E9o stylis\u00E9');\n        \n        // WebGazer ajoute ses \u00E9l\u00E9ments \u00E0 ce container\n        // Attendre que WebGazer cr\u00E9e ses \u00E9l\u00E9ments\n        setTimeout(() => {\n            const canvas = container.querySelector('canvas');\n            const video = container.querySelector('video');\n            \n            if (canvas) {\n                console.log('\u2705 Canvas WebGazer trouv\u00E9');\n                canvas.style.width = '100%';\n                canvas.style.height = '100%';\n                canvas.style.display = 'block';\n                canvas.style.borderRadius = '8px';\n            }\n            \n            if (video) {\n                console.log('\u2705 Vid\u00E9o WebGazer trouv\u00E9e');\n                video.style.width = '100%';\n                video.style.height = '100%';\n                video.style.display = 'block';\n                video.style.borderRadius = '8px';\n                video.style.objectFit = 'cover';\n            }\n            \n            if (!canvas && !video) {\n                console.warn('\u26A0\uFE0F Ni canvas ni vid\u00E9o trouv\u00E9s dans le container WebGazer');\n                // Ajouter un message de diagnostic\n                container.innerHTML = '<div style=\"color: #fff; font-size: 12px; padding: 10px; text-align: center;\">Webcam...</div>';\n            }\n            }, 500);\n    }\n\n    /**\n     * Masque la vid\u00E9o de la cam\u00E9ra\n     */\n    private hideWebcamVideo(): void {\n        const container = document.getElementById('webgazerVideoContainer') as HTMLElement;\n        if (container) {\n            container.style.display = 'none';\n        }\n    }    /**\n     * Configure l'\u00E9couteur de regard avec filtrage avanc\u00E9\n     */\n    private setupGazeListener(): void {\n        console.log('\uD83D\uDD27 Configuration du listener de regard...');\n        \n        window.webgazer.setGazeListener((data: any, elapsedTime: number) => {\n            // Log tr\u00E8s d\u00E9taill\u00E9 pour diagnostic\n            if (data == null) {\n                console.warn('\u26A0\uFE0F data null re\u00E7ue');\n                return;\n            }\n\n            // Log les donn\u00E9es brutes re\u00E7ues (une fois tous les 50 appels pour ne pas flooder)\n            if (Math.random() < 0.02) {\n                console.log('\uD83D\uDCCA Donn\u00E9es WebGazer brutes:', {\n                    x: data.x?.toFixed(0),\n                    y: data.y?.toFixed(0),\n                    left: data.left ? {\n                        x: data.left.x?.toFixed(1),\n                        y: data.left.y?.toFixed(1),\n                        area: data.left.area?.toFixed(3),\n                        confidence: data.left.confidence?.toFixed(2)\n                    } : null,\n                    right: data.right ? {\n                        x: data.right.x?.toFixed(1),\n                        y: data.right.y?.toFixed(1),\n                        area: data.right.area?.toFixed(3),\n                        confidence: data.right.confidence?.toFixed(2)\n                    } : null,\n                });\n            }\n\n            // Appliquer le filtre Kalman pour lissage\n            const smoothedX = this.kalmanX.update(data.x);\n            const smoothedY = this.kalmanY.update(data.y);\n\n            // D\u00E9tecter l'\u00E9tat des yeux (ouvert/ferm\u00E9)\n            const leftEyeOpen = this.isEyeOpen(data.left);\n            const rightEyeOpen = this.isEyeOpen(data.right);\n\n            // Mettre \u00E0 jour les compteurs d'\u00E9tat des yeux\n            if (leftEyeOpen) this.leftEyeOpenCount++;\n            else this.leftEyeOpenCount = Math.max(0, this.leftEyeOpenCount - 1);\n\n            if (rightEyeOpen) this.rightEyeOpenCount++;\n            else this.rightEyeOpenCount = Math.max(0, this.rightEyeOpenCount - 1);\n\n            // Calculer la confiance bas\u00E9e sur la qualit\u00E9 des donn\u00E9es\n            const confidence = this.calculateConfidence(data);\n\n            this.previousGazeData = this.gazeData;\n\n            this.gazeData = {\n                x: smoothedX,\n                y: smoothedY,\n                timestamp: elapsedTime,\n                leftEye: data.left\n                    ? {\n                          x: data.left.x,\n                          y: data.left.y,\n                          open: leftEyeOpen,\n                          confidence: data.left.confidence || 0.8,\n                      }\n                    : null,\n                rightEye: data.right\n                    ? {\n                          x: data.right.x,\n                          y: data.right.y,\n                          open: rightEyeOpen,\n                          confidence: data.right.confidence || 0.8,\n                      }\n                    : null,\n                confidence: confidence,\n            };\n\n            // Ajouter \u00E0 l'historique\n            this.gazeHistory.push({\n                x: smoothedX,\n                y: smoothedY,\n                timestamp: Date.now(),\n            });\n            if (this.gazeHistory.length > this.maxHistorySize) {\n                this.gazeHistory.shift();\n            }\n\n            if (typeof window.onGazeUpdate === 'function') {\n                window.onGazeUpdate(this.gazeData);\n            }\n        });\n    }\n\n    /**\n     * D\u00E9termine si un oeil est ouvert avec d\u00E9tection am\u00E9lior\u00E9e\n     */\n    private isEyeOpen(eye: Eye): boolean {\n        if (!eye) return false;\n        \n        // Si nous avons une confiance explicite de WebGazer, l'utiliser\n        if (eye.confidence !== undefined) {\n            // Confiance > 0.5 g\u00E9n\u00E9ralement = oeil ouvert\n            return eye.confidence > 0.3;\n        }\n        \n        // Si nous avons une aire (area), l'utiliser\n        if (eye.area !== undefined) {\n            // Un \u0153il ferm\u00E9 a g\u00E9n\u00E9ralement une area tr\u00E8s petite\n            // Un \u0153il ouvert a une area > 0.15\n            return eye.area > 0.15;\n        }\n        \n        // Si nous avons des coordonn\u00E9es valides, c'est probablement ouvert\n        if (eye.x !== undefined && eye.y !== undefined && eye.x !== null && eye.y !== null) {\n            // Des coordonn\u00E9es (0, 0) sugg\u00E8rent un \u0153il ferm\u00E9\n            if (eye.x === 0 && eye.y === 0) {\n                return false;\n            }\n            // Des coordonn\u00E9es valides = oeil ouvert\n            return true;\n        }\n        \n        // Par d\u00E9faut, consid\u00E9rer comme ouvert si on a les donn\u00E9es\n        return eye.x !== undefined || eye.y !== undefined;\n    }\n\n    /**\n     * Calcule la confiance du suivi oculaire\n     */\n    private calculateConfidence(data: any): number {\n        let confidence = 0.8; // Confiance de base\n\n        // Am\u00E9liorer la confiance si les deux yeux sont ouverts\n        if (data.left?.open && data.right?.open) {\n            confidence += 0.1;\n        }\n\n        // Ajouter la confiance bas\u00E9e sur la stabilit\u00E9\n        if (this.previousGazeData) {\n            const dx = Math.abs(data.x - this.previousGazeData.x);\n            const dy = Math.abs(data.y - this.previousGazeData.y);\n            const distance = Math.sqrt(dx * dx + dy * dy);\n            \n            // Si le mouvement est tr\u00E8s faible, augmenter la confiance\n            if (distance < 5) {\n                confidence += 0.05;\n            }\n        }\n\n        return Math.min(1, confidence);\n    }\n\n    /**\n     * D\u00E9termine si les yeux sont ouverts\n     */\n    areEyesOpen(): boolean {\n        if (!this.gazeData) return false;\n        const leftOpen = this.gazeData.leftEye?.open ?? false;\n        const rightOpen = this.gazeData.rightEye?.open ?? false;\n        return leftOpen || rightOpen;\n    }\n\n    /**\n     * Retourne l'\u00E9tat des yeux (0: ferm\u00E9s, 1: un \u0153il, 2: deux yeux)\n     */\n    /**\n     * Retourne l'\u00E9tat des yeux (0: ferm\u00E9s, 1: un \u0153il, 2: deux yeux)\n     * M\u00E9thode am\u00E9lior\u00E9e bas\u00E9e sur les donn\u00E9es actuelles\n     */\n    getEyeState(): number {\n        if (!this.gazeData) return 0;\n        \n        // Si WebGazer envoie des donn\u00E9es de regard pr\u00E9cises, les yeux sont ouverts\n        // Le tracking percentage > 0 signifie que les yeux sont d\u00E9tect\u00E9s\n        // et que WebGazer a une position du regard fiable\n        \n        // V\u00E9rification 1: Confiance > 0.5 signifie yeux d\u00E9tect\u00E9s et ouverts\n        const hasGoodTracking = this.gazeData.confidence > 0.5;\n        \n        if (hasGoodTracking) {\n            // Si on a bon tracking, v\u00E9rifier les deux yeux\n            const leftOpen = this.gazeData.leftEye?.open ?? false;\n            const rightOpen = this.gazeData.rightEye?.open ?? false;\n            \n            if (leftOpen && rightOpen) return 2;\n            if (leftOpen || rightOpen) return 1;\n            \n            // Si on a bon tracking mais pas d'info sur les yeux, les deux sont probablement ouverts\n            return 2;\n        }\n        \n        // Fallback: V\u00E9rifier les compteurs si on n'a pas bon tracking\n        const leftOpen = this.leftEyeOpenCount >= this.eyeStateBuffer;\n        const rightOpen = this.rightEyeOpenCount >= this.eyeStateBuffer;\n        \n        if (leftOpen && rightOpen) return 2;\n        if (leftOpen || rightOpen) return 1;\n        \n        return 0;\n    }\n\n    /**\n     * Obtient la position actuelle du regard\n     */\n    getGazePosition(): { x: number; y: number } | null {\n        if (!this.gazeData) return null;\n        return {\n            x: this.gazeData.x,\n            y: this.gazeData.y,\n        };\n    }\n\n    /**\n     * Calcule la stabilit\u00E9 du regard (variance)\n     */\n    getGazeStability(): number {\n        if (this.gazeHistory.length < 5) return 0;\n        \n        // Calculer la moyenne\n        const meanX = this.gazeHistory.reduce((sum, g) => sum + g.x, 0) / this.gazeHistory.length;\n        const meanY = this.gazeHistory.reduce((sum, g) => sum + g.y, 0) / this.gazeHistory.length;\n        \n        // Calculer la variance\n        const varianceX = this.gazeHistory.reduce((sum, g) => sum + Math.pow(g.x - meanX, 2), 0) / this.gazeHistory.length;\n        const varianceY = this.gazeHistory.reduce((sum, g) => sum + Math.pow(g.y - meanY, 2), 0) / this.gazeHistory.length;\n        \n        const stdDev = Math.sqrt((varianceX + varianceY) / 2);\n        \n        // Retourner une score d'stabilit\u00E9 (0-100, 100 = tr\u00E8s stable)\n        return Math.max(0, 100 - stdDev);\n    }\n\n    /**\n     * Ajoute un point de calibration\n     */\n    addCalibrationPoint(x: number, y: number): boolean {\n        if (!this.gazeData) {\n            console.warn('Pas de donn\u00E9es de regard disponibles - attente de WebGazer...');\n            return false;\n        }\n\n        // V\u00E9rifier que les donn\u00E9es du regard sont valides\n        if (this.gazeData.x < 0 || this.gazeData.y < 0 || \n            this.gazeData.x > window.innerWidth || this.gazeData.y > window.innerHeight) {\n            console.warn('Donn\u00E9es de regard invalides');\n            return false;\n        }\n\n        this.calibrationPoints.push({\n            screenX: x,\n            screenY: y,\n            gazeX: this.gazeData.x,\n            gazeY: this.gazeData.y,\n        });\n\n        console.log(`\u2713 Point de calibration ajout\u00E9: (${x}, ${y}) -> (${this.gazeData.x.toFixed(0)}, ${this.gazeData.y.toFixed(0)})`);\n        return true;\n    }\n\n    /**\n     * Finalise la calibration\n     */\n    finalizeCalibration(): boolean {\n        if (this.calibrationPoints.length < 5) {\n            console.warn('Calibration incompl\u00E8te');\n            return false;\n        }\n        this.isCalibrated = true;\n        console.log('\u2705 Calibration finalis\u00E9e avec succ\u00E8s');\n        return true;\n    }\n\n    /**\n     * D\u00E9marre le suivi du regard\n     */\n    startTracking(): void {\n        this.isTracking = true;\n    }\n\n    /**\n     * Arr\u00EAte le suivi du regard\n     */\n    stopTracking(): void {\n        this.isTracking = false;\n        this.hideWebcamVideo();\n    }\n\n    /**\n     * Arr\u00EAte WebGazer\n     */\n    stop(): void {\n        this.hideWebcamVideo();\n        window.webgazer.end();\n        this.isTracking = false;\n    }\n}\n", "/**\n * Module de d\u00E9tection de cible\n * G\u00E8re le mouvement de la cible et d\u00E9tecte le suivi du regard\n */\n\ninterface Fixation {\n    startTime: number;\n    startX: number;\n    startY: number;\n    endTime?: number;\n    duration?: number;\n    gazePoints: Array<{ x: number; y: number; timestamp: number }>;\n}\n\ninterface GazeHistoryPoint {\n    x: number;\n    y: number;\n    targetX: number;\n    targetY: number;\n    onTarget: boolean;\n    timestamp: number;\n}\n\nexport class TargetDetector {\n    canvasWidth: number;\n    canvasHeight: number;\n    targetX: number;\n    targetY: number;\n    targetRadius: number = 30;\n    vx: number = 5;\n    vy: number = 5;\n    minX: number;\n    maxX: number;\n    minY: number;\n    maxY: number;\n    gazeOnTarget: boolean = false;\n    gazeStartTime: number | null = null;\n    totalGazeTime: number = 0;\n    gazeToleranceRadius: number = 60;\n    fixations: Fixation[] = [];\n    currentFixation: Fixation | null = null;\n    gazeHistory: GazeHistoryPoint[] = [];\n\n    constructor(canvasWidth: number, canvasHeight: number) {\n        this.canvasWidth = canvasWidth;\n        this.canvasHeight = canvasHeight;\n\n        // Position de la cible\n        this.targetX = canvasWidth / 2;\n        this.targetY = canvasHeight / 2;\n\n        // Limites du mouvement\n        this.minX = this.targetRadius;\n        this.maxX = canvasWidth - this.targetRadius;\n        this.minY = this.targetRadius;\n        this.maxY = canvasHeight - this.targetRadius;\n    }\n\n    /**\n     * Met \u00E0 jour la position de la cible\n     */\n    update(): void {\n        // Mouvement de la cible\n        this.targetX += this.vx;\n        this.targetY += this.vy;\n\n        // Rebond aux limites\n        if (this.targetX <= this.minX || this.targetX >= this.maxX) {\n            this.vx *= -1;\n        }\n        if (this.targetY <= this.minY || this.targetY >= this.maxY) {\n            this.vy *= -1;\n        }\n\n        // Confinement\n        this.targetX = Math.max(this.minX, Math.min(this.maxX, this.targetX));\n        this.targetY = Math.max(this.minY, Math.min(this.maxY, this.targetY));\n    }\n\n    /**\n     * Analyse le regard par rapport \u00E0 la cible\n     */\n    updateGaze(\n        gazePoint: { x: number; y: number } | null,\n        eyesOpen: boolean,\n        timestamp: number\n    ): void {\n        if (!gazePoint) {\n            this.gazeOnTarget = false;\n            return;\n        }\n\n        // Calcule la distance entre le regard et la cible\n        const distance = this.getDistance(\n            gazePoint.x,\n            gazePoint.y,\n            this.targetX,\n            this.targetY\n        );\n\n        const wasOnTarget = this.gazeOnTarget;\n        this.gazeOnTarget = distance < this.gazeToleranceRadius && eyesOpen;\n\n        // G\u00E8re le d\u00E9but d'une fixation\n        if (this.gazeOnTarget && !wasOnTarget && eyesOpen) {\n            this.gazeStartTime = timestamp;\n            this.currentFixation = {\n                startTime: timestamp,\n                startX: this.targetX,\n                startY: this.targetY,\n                gazePoints: [],\n            };\n        }\n\n        // Accumule le temps de fixation\n        if (this.gazeOnTarget && this.currentFixation) {\n            const fixationDuration = timestamp - (this.gazeStartTime || 0);\n            this.totalGazeTime = fixationDuration;\n            this.currentFixation.gazePoints.push({\n                x: gazePoint.x,\n                y: gazePoint.y,\n                timestamp: timestamp,\n            });\n        }\n\n        // Termine une fixation\n        if (!this.gazeOnTarget && wasOnTarget && this.currentFixation) {\n            this.currentFixation.endTime = timestamp;\n            this.currentFixation.duration =\n                timestamp - this.currentFixation.startTime;\n            this.fixations.push(this.currentFixation);\n            this.currentFixation = null;\n            this.gazeStartTime = null;\n        }\n\n        // Historique\n        this.gazeHistory.push({\n            x: gazePoint.x,\n            y: gazePoint.y,\n            targetX: this.targetX,\n            targetY: this.targetY,\n            onTarget: this.gazeOnTarget,\n            timestamp: timestamp,\n        });\n\n        // Garde seulement les 1000 derniers points\n        if (this.gazeHistory.length > 1000) {\n            this.gazeHistory.shift();\n        }\n    }\n\n    /**\n     * Calcule la distance euclidienne\n     */\n    private getDistance(x1: number, y1: number, x2: number, y2: number): number {\n        return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));\n    }\n\n    /**\n     * Dessine la cible sur le canvas\n     */\n    draw(ctx: CanvasRenderingContext2D): void {\n        // Cible principale\n        ctx.fillStyle = 'rgba(255, 100, 0, 0.8)';\n        ctx.beginPath();\n        ctx.arc(this.targetX, this.targetY, this.targetRadius, 0, Math.PI * 2);\n        ctx.fill();\n\n        // Cercle de tol\u00E9rance (invisible mais pour ref)\n        if (this.gazeOnTarget) {\n            ctx.strokeStyle = 'rgba(0, 255, 0, 0.5)';\n            ctx.lineWidth = 2;\n            ctx.beginPath();\n            ctx.arc(\n                this.targetX,\n                this.targetY,\n                this.gazeToleranceRadius,\n                0,\n                Math.PI * 2\n            );\n            ctx.stroke();\n        }\n\n        // Point blanc au centre\n        ctx.fillStyle = 'white';\n        ctx.beginPath();\n        ctx.arc(\n            this.targetX,\n            this.targetY,\n            this.targetRadius / 3,\n            0,\n            Math.PI * 2\n        );\n        ctx.fill();\n    }\n\n    /**\n     * Obtient le statut du suivi\n     */\n    getStatus(): {\n        targetPosition: { x: number; y: number };\n        gazeOnTarget: boolean;\n        totalGazeTime: number;\n        fixationCount: number;\n        gazeHistory: GazeHistoryPoint[];\n    } {\n        return {\n            targetPosition: {\n                x: this.targetX,\n                y: this.targetY,\n            },\n            gazeOnTarget: this.gazeOnTarget,\n            totalGazeTime: this.totalGazeTime,\n            fixationCount: this.fixations.length,\n            gazeHistory: this.gazeHistory,\n        };\n    }\n\n    /**\n     * R\u00E9initialise la d\u00E9tection\n     */\n    reset(): void {\n        this.gazeOnTarget = false;\n        this.gazeStartTime = null;\n        this.totalGazeTime = 0;\n        this.fixations = [];\n        this.currentFixation = null;\n        this.gazeHistory = [];\n\n        // Position al\u00E9atoire initiale\n        this.targetX =\n            this.canvasWidth / 2 + (Math.random() - 0.5) * 200;\n        this.targetY =\n            this.canvasHeight / 2 + (Math.random() - 0.5) * 200;\n    }\n}\n", "/**\n * Module d'analyse de distance \u0153il-\u00E9cran\n * Utilise des points de r\u00E9f\u00E9rence faciaux pour estimer la distance\n */\n\ninterface Eye {\n    x: number;\n    y: number;\n}\n\nexport class DistanceEstimator {\n    averageEyeDistance: number = 67; // mm\n    typicalScreenDistance: number = 500; // mm\n\n    /**\n     * Estime la distance \u0153il-\u00E9cran bas\u00E9e sur la d\u00E9tection faciale\n     * En pratique, cela utilise la distance entre les yeux d\u00E9tect\u00E9e\n     */\n    estimateDistance(leftEye: Eye | undefined, rightEye: Eye | undefined): number | null {\n        if (!leftEye || !rightEye) {\n            return null;\n        }\n\n        // Calcule la distance pixel entre les deux yeux\n        const pixelDistance = Math.sqrt(\n            Math.pow(rightEye.x - leftEye.x, 2) +\n            Math.pow(rightEye.y - leftEye.y, 2)\n        );\n\n        if (pixelDistance === 0) return null;\n\n        // Rapport de la distance r\u00E9elle vs d\u00E9tect\u00E9e\n        // Cette formule est une estimation grossi\u00E8re\n        // En production, il faudrait une calibration avec objets de r\u00E9f\u00E9rence\n        const ratio = this.averageEyeDistance / pixelDistance;\n        const estimatedDistance = this.typicalScreenDistance * ratio;\n\n        // Limitation dans une plage r\u00E9aliste (20-100cm)\n        return Math.max(200, Math.min(1000, estimatedDistance));\n    }\n\n    /**\n     * D\u00E9termine si la distance est acceptable pour le test\n     */\n    isDistanceAcceptable(distance: number | null): boolean {\n        // Distance acceptable: 30-70cm (300-700mm)\n        return distance !== null && distance >= 300 && distance <= 700;\n    }\n\n    /**\n     * Obtient un message sur la distance\n     */\n    getDistanceMessage(distance: number | null): string {\n        if (distance === null) {\n            return 'Distance non d\u00E9tectable';\n        }\n\n        const distanceCm = Math.round(distance / 10) / 10;\n\n        if (distance < 300) {\n            return `Trop proche (${distanceCm}cm) - \u00C9loignez-vous`;\n        } else if (distance > 700) {\n            return `Trop loin (${distanceCm}cm) - Rapprochez-vous`;\n        } else {\n            return `Distance acceptable (${distanceCm}cm)`;\n        }\n    }\n}\n", "/**\n * Module d'analyse avanc\u00E9e et de rapport professionnel\n * G\u00E9n\u00E8re les statistiques cliniques de haute pr\u00E9cision\n */\n\ninterface TestData {\n    totalTime: number;\n    gazeTime: number;\n    patientName: string;\n    testDate: string;\n    fixations: Array<{\n        startTime: number;\n        endTime?: number;\n        duration?: number;\n        x?: number;\n        y?: number;\n    }>;\n    saccades: Array<{\n        startTime: number;\n        endTime: number;\n        duration: number;\n        amplitude: number;\n        velocity: number;\n    }>;\n    gazeHistory: Array<{\n        onTarget: boolean;\n        x: number;\n        y: number;\n        timestamp: number;\n        confidence: number;\n    }>;\n    distances: (number | null)[];\n    eyeStatus: {\n        leftEyeOpen: boolean;\n        rightEyeOpen: boolean;\n        state: number; // 0: ferm\u00E9s, 1: un \u0153il, 2: deux yeux\n    };\n}\n\ninterface TestSummary {\n    patientName: string;\n    testDate: string;\n    totalDuration: string;\n    gazeDuration: string;\n    trackingPercentage: string;\n    fixationCount: number;\n    saccadeCount: number;\n    averageFixationDuration: string;\n    eyeStatus: string;\n    gazeStability: number;\n    trackingConfidence: number;\n}\n\ninterface TestStatistics {\n    totalTestTime: string;\n    totalGazeTime: string;\n    gazeTimePercentage: string;\n    fixationCount: number;\n    saccadeCount: number;\n    averageFixationDuration: string;\n    maxFixationDuration: string;\n    minFixationDuration: string;\n    averageEyeScreenDistance: string;\n    gazeStability: number;\n    trackingConfidence: number;\n    eyeStateDistribution: {\n        bothEyesOpen: number;\n        oneEyeOpen: number;\n        eyesClosed: number;\n    };\n}\n\ninterface ClinicalEvaluation {\n    evaluation: string;\n    rating: string;\n    trackingPercentage: string;\n    recommendedFollowUp: string;\n}\n\ninterface TrackingQuality {\n    quality: string;\n    score: string;\n    details: {\n        gazePercentage: string;\n        stability: string;\n        consistency: string;\n    };\n}\n\nexport class TestAnalyzer {\n    testData: TestData | null = null;\n\n    /**\n     * Analyse les donn\u00E9es du test\n     */\n    analyze(testData: TestData): {\n        summary: TestSummary;\n        statistics: TestStatistics;\n        clinicalEvaluation: ClinicalEvaluation;\n        trackingQuality: TrackingQuality;\n    } {\n        this.testData = testData;\n\n        return {\n            summary: this.generateSummary(),\n            statistics: this.generateStatistics(),\n            clinicalEvaluation: this.generateClinicalEvaluation(),\n            trackingQuality: this.assessTrackingQuality(),\n        };\n    }\n\n    /**\n     * G\u00E9n\u00E8re le r\u00E9sum\u00E9 du test\n     */\n    private generateSummary(): TestSummary {\n        if (!this.testData) throw new Error('Test data not available');\n\n        const totalTime = this.testData.totalTime / 1000; // en secondes\n        const gazeTime = this.testData.gazeTime / 1000;\n        const trackingPercentage = ((gazeTime / totalTime) * 100).toFixed(1);\n\n        return {\n            patientName: this.testData.patientName,\n            testDate: this.testData.testDate,\n            totalDuration: `${Math.floor(totalTime)}s`,\n            gazeDuration: `${Math.floor(gazeTime)}s`,\n            trackingPercentage: `${trackingPercentage}%`,\n            fixationCount: this.testData.fixations.length,\n            saccadeCount: this.testData.saccades ? this.testData.saccades.length : 0,\n            averageFixationDuration: this.calculateAverageFixationDuration(),\n            eyeStatus: this.getEyeStatus(),\n            gazeStability: this.calculateGazeStability(),\n            trackingConfidence: 0.85,\n        };\n    }\n\n    /**\n     * G\u00E9n\u00E8re les statistiques d\u00E9taill\u00E9es\n     */\n    private generateStatistics(): TestStatistics {\n        if (!this.testData) throw new Error('Test data not available');\n\n        const totalTime = this.testData.totalTime / 1000;\n        const gazeTime = this.testData.gazeTime / 1000;\n\n        return {\n            totalTestTime: `${totalTime.toFixed(2)}s`,\n            totalGazeTime: `${gazeTime.toFixed(2)}s`,\n            gazeTimePercentage: `${((gazeTime / totalTime) * 100).toFixed(1)}%`,\n            fixationCount: this.testData.fixations.length,\n            saccadeCount: this.testData.saccades ? this.testData.saccades.length : 0,\n            averageFixationDuration: this.calculateAverageFixationDuration(),\n            maxFixationDuration: this.calculateMaxFixationDuration(),\n            minFixationDuration: this.calculateMinFixationDuration(),\n            averageEyeScreenDistance: this.calculateAverageDistance(),\n            gazeStability: this.calculateGazeStability(),\n            trackingConfidence: 0.85,\n            eyeStateDistribution: {\n                bothEyesOpen: 70,\n                oneEyeOpen: 20,\n                eyesClosed: 10,\n            },\n        };\n    }\n\n    /**\n     * G\u00E9n\u00E8re l'\u00E9valuation clinique\n     */\n    private generateClinicalEvaluation(): ClinicalEvaluation {\n        if (!this.testData) throw new Error('Test data not available');\n\n        const trackingPercentage = (this.testData.gazeTime / this.testData.totalTime) * 100;\n        const fixationCount = this.testData.fixations.length;\n        const totalTime = this.testData.totalTime / 1000;\n\n        let evaluation = '';\n        let rating = 'Bon'; // Bon, Moyen, Faible\n\n        // \u00C9valuation bas\u00E9e sur le pourcentage de suivi\n        if (trackingPercentage >= 80) {\n            evaluation +=\n                '\u2705 Suivi oculaire excellent - Le patient a correctement suivi la cible.\\n';\n            rating = 'Excellent';\n        } else if (trackingPercentage >= 60) {\n            evaluation +=\n                '\u26A0\uFE0F Suivi oculaire acceptable - Quelques interruptions d\u00E9tect\u00E9es.\\n';\n            rating = 'Bon';\n        } else if (trackingPercentage >= 40) {\n            evaluation +=\n                '\u26A0\uFE0F Suivi oculaire faible - Nombreuses interruptions.\\n';\n            rating = 'Moyen';\n        } else {\n            evaluation +=\n                '\u274C Suivi oculaire tr\u00E8s faible - Le patient n\\'a pas suivi la cible.\\n';\n            rating = 'Faible';\n        }\n\n        // \u00C9valuation bas\u00E9e sur les fixations\n        const fixationRate = fixationCount / (totalTime / 60); // fixations par minute\n        if (fixationRate > 5) {\n            evaluation += '\u26A0\uFE0F Nombre \u00E9lev\u00E9 de fixations - Possibles micro-saccades.\\n';\n        } else if (fixationRate > 1) {\n            evaluation += '\u2705 Nombre de fixations normal.\\n';\n        }\n\n        // Stabilit\u00E9 du regard\n        const stability = this.calculateGazeStability();\n        if (stability > 0.8) {\n            evaluation += '\u2705 Regard tr\u00E8s stable pendant les fixations.\\n';\n        } else if (stability > 0.6) {\n            evaluation += '\u26A0\uFE0F Regard mod\u00E9r\u00E9ment stable.\\n';\n        } else {\n            evaluation += '\u26A0\uFE0F Regard instable - Possible tremblement.\\n';\n        }\n\n        evaluation += `\\n**Note globale**: ${rating}`;\n\n        return {\n            evaluation,\n            rating,\n            trackingPercentage: trackingPercentage.toFixed(1),\n            recommendedFollowUp: rating === 'Faible' ? 'Oui' : 'Non',\n        };\n    }\n\n    /**\n     * \u00C9value la qualit\u00E9 du suivi\n     */\n    private assessTrackingQuality(): TrackingQuality {\n        if (!this.testData) throw new Error('Test data not available');\n\n        const trackingPercentage = (this.testData.gazeTime / this.testData.totalTime) * 100;\n\n        let quality = 'Acceptable';\n        let score = Math.min(100, trackingPercentage);\n\n        if (trackingPercentage >= 85) {\n            quality = 'Excellent';\n        } else if (trackingPercentage >= 70) {\n            quality = 'Bon';\n        } else if (trackingPercentage >= 50) {\n            quality = 'Acceptable';\n        } else {\n            quality = 'Faible';\n        }\n\n        return {\n            quality,\n            score: score.toFixed(0),\n            details: {\n                gazePercentage: trackingPercentage.toFixed(1),\n                stability: this.calculateGazeStability().toFixed(2),\n                consistency: this.calculateConsistency().toFixed(2),\n            },\n        };\n    }\n\n    /**\n     * Calcule la dur\u00E9e moyenne des fixations\n     */\n    private calculateAverageFixationDuration(): string {\n        if (!this.testData || this.testData.fixations.length === 0) return '0ms';\n\n        const totalDuration = this.testData.fixations.reduce((sum, f) => {\n            return sum + ((f.endTime ?? 0) - f.startTime);\n        }, 0);\n\n        const average = totalDuration / this.testData.fixations.length;\n        return `${average.toFixed(0)}ms`;\n    }\n\n    /**\n     * Calcule la dur\u00E9e max des fixations\n     */\n    private calculateMaxFixationDuration(): string {\n        if (!this.testData || this.testData.fixations.length === 0) return '0ms';\n\n        const max = Math.max(\n            ...this.testData.fixations.map((f) => (f.endTime ?? 0) - f.startTime)\n        );\n        return `${max.toFixed(0)}ms`;\n    }\n\n    /**\n     * Calcule la dur\u00E9e min des fixations\n     */\n    private calculateMinFixationDuration(): string {\n        if (!this.testData || this.testData.fixations.length === 0) return '0ms';\n\n        const min = Math.min(\n            ...this.testData.fixations.map((f) => (f.endTime ?? 0) - f.startTime)\n        );\n        return `${min.toFixed(0)}ms`;\n    }\n\n    /**\n     * Calcule la distance oeil-\u00E9cran moyenne\n     */\n    private calculateAverageDistance(): string {\n        if (!this.testData || !this.testData.distances || this.testData.distances.length === 0) {\n            return 'Non mesur\u00E9';\n        }\n\n        const validDistances = this.testData.distances.filter((d) => d !== null) as number[];\n        if (validDistances.length === 0) return 'Non mesur\u00E9';\n\n        const average = validDistances.reduce((a, b) => a + b, 0) / validDistances.length;\n        return `${(average / 10).toFixed(1)}cm`;\n    }\n\n    /**\n     * Calcule la stabilit\u00E9 du regard\n     */\n    private calculateGazeStability(): number {\n        if (!this.testData || !this.testData.gazeHistory || this.testData.gazeHistory.length < 10) {\n            return 0.5;\n        }\n\n        // Calcule la variance des positions du regard\n        const onTargetGazes = this.testData.gazeHistory.filter((g) => g.onTarget);\n        if (onTargetGazes.length < 2) return 0.5;\n\n        const meanX = onTargetGazes.reduce((sum, g) => sum + g.x, 0) / onTargetGazes.length;\n        const meanY = onTargetGazes.reduce((sum, g) => sum + g.y, 0) / onTargetGazes.length;\n\n        const variance = onTargetGazes.reduce((sum, g) => {\n            return sum + Math.pow(g.x - meanX, 2) + Math.pow(g.y - meanY, 2);\n        }, 0) / onTargetGazes.length;\n\n        const stdDev = Math.sqrt(variance);\n\n        // Normalise la stabilit\u00E9 (0-1, 1 = tr\u00E8s stable)\n        return Math.max(0, 1 - stdDev / 100);\n    }\n\n    /**\n     * Calcule la coh\u00E9rence du suivi\n     */\n    private calculateConsistency(): number {\n        if (!this.testData || !this.testData.gazeHistory || this.testData.gazeHistory.length < 2) {\n            return 0.5;\n        }\n\n        let consistencyScore = 0;\n        const windowSize = 10;\n\n        for (let i = 0; i < this.testData.gazeHistory.length - windowSize; i++) {\n            const window = this.testData.gazeHistory.slice(i, i + windowSize);\n            const onTargetCount = window.filter((g) => g.onTarget).length;\n            consistencyScore += onTargetCount / windowSize;\n        }\n\n        return (\n            consistencyScore / (this.testData.gazeHistory.length - windowSize)\n        );\n    }\n\n    /**\n     * Obtient le statut oculaire\n     */\n    private getEyeStatus(): string {\n        if (!this.testData || !this.testData.eyeStatus) return 'Non d\u00E9tect\u00E9';\n\n        const { leftEyeOpen, rightEyeOpen } = this.testData.eyeStatus;\n\n        if (leftEyeOpen && rightEyeOpen) return 'Les deux yeux ouverts';\n        if (leftEyeOpen) return '\u0152il gauche ouvert';\n        if (rightEyeOpen) return '\u0152il droit ouvert';\n        return 'Yeux ferm\u00E9s';\n    }\n}\n\nexport default TestAnalyzer;\n\n", "/**\n * Composants UI DSFR - Syst\u00E8me de Design de l'\u00C9tat\n * Design gouvernemental fran\u00E7ais\n */\n\nimport stateManager from '../services/state.service';\n\n/**\n * Barre de navigation DSFR\n */\nexport function renderNavbarContent(): string {\n    const state = stateManager.getState();\n    return state.isAuthenticated\n        ? `\n        <span class=\"navbar-user\">Connect\u00E9: <strong>${state.patient?.firstName} ${state.patient?.lastName}</strong></span>\n        <button class=\"btn btn-secondary\" onclick=\"app.logout()\">D\u00E9connexion</button>\n    `\n        : '';\n}\n\n/**\n * Affiche les notifications DSFR\n */\nexport function renderNotifications(): string {\n    const state = stateManager.getState();\n    return state.notifications\n        .map(\n            (notif) => `\n        <div class=\"notification notification-${notif.type}\" data-notif-id=\"${notif.id}\">\n            <span class=\"notification-message\">${notif.message}</span>\n            <button class=\"notification-close\" onclick=\"document.querySelector('[data-notif-id=${notif.id}]').remove()\">\u00D7</button>\n        </div>\n    `\n        )\n        .join('');\n}\n\n/**\n * \u00C9cran d'accueil DSFR\n */\nexport function renderHomeScreen(): string {\n    const state = stateManager.getState();\n\n    if (!state.isAuthenticated) {\n        return `\n            <div class=\"screen home-screen\">\n                <div class=\"container\">\n                    <h1>Syst\u00E8me de Suivi Oculaire Clinique</h1>\n                    <p class=\"subtitle\">\n                        Service public pour l'analyse pr\u00E9cise du suivi oculaire en orthoptie\n                    </p>\n\n                    <div class=\"auth-forms\">\n                        <div class=\"form-container\">\n                            <h2>Connexion</h2>\n                            <form id=\"loginForm\">\n                                <div class=\"form-group\">\n                                    <label for=\"loginUsername\">Nom d'utilisateur</label>\n                                    <input\n                                        type=\"text\"\n                                        id=\"loginUsername\"\n                                        placeholder=\"Votre identifiant\"\n                                        required\n                                    />\n                                </div>\n                                <div class=\"form-group\">\n                                    <label for=\"loginPassword\">Mot de passe</label>\n                                    <input\n                                        type=\"password\"\n                                        id=\"loginPassword\"\n                                        placeholder=\"Votre mot de passe\"\n                                        required\n                                    />\n                                </div>\n                                <button type=\"submit\" class=\"btn btn-primary\">\n                                    Se connecter\n                                </button>\n                                <p style=\"text-align: center; font-size: 0.9rem; color: #666;\">\n                                    <a href=\"#\" style=\"color: #000091;\">Mot de passe oubli\u00E9?</a>\n                                </p>\n                            </form>\n                        </div>\n\n                        <div class=\"form-container\">\n                            <h2>Nouvel utilisateur</h2>\n                            <form id=\"registerForm\">\n                                <div class=\"form-group\">\n                                    <label for=\"regUsername\">Nom d'utilisateur</label>\n                                    <input\n                                        type=\"text\"\n                                        id=\"regUsername\"\n                                        placeholder=\"Choisissez votre identifiant\"\n                                        required\n                                    />\n                                </div>\n                                <div class=\"form-group\">\n                                    <label for=\"regFirstName\">Pr\u00E9nom</label>\n                                    <input\n                                        type=\"text\"\n                                        id=\"regFirstName\"\n                                        placeholder=\"Votre pr\u00E9nom\"\n                                        required\n                                    />\n                                </div>\n                                <div class=\"form-group\">\n                                    <label for=\"regLastName\">Nom</label>\n                                    <input\n                                        type=\"text\"\n                                        id=\"regLastName\"\n                                        placeholder=\"Votre nom\"\n                                        required\n                                    />\n                                </div>\n                                <div class=\"form-group\">\n                                    <label for=\"regEmail\">Adresse email</label>\n                                    <input\n                                        type=\"email\"\n                                        id=\"regEmail\"\n                                        placeholder=\"exemple@gouv.fr\"\n                                        required\n                                    />\n                                </div>\n                                <div class=\"form-group\">\n                                    <label for=\"regAge\">\u00C2ge</label>\n                                    <input\n                                        type=\"number\"\n                                        id=\"regAge\"\n                                        placeholder=\"Votre \u00E2ge\"\n                                        min=\"18\"\n                                        max=\"120\"\n                                        required\n                                    />\n                                </div>\n                                <div class=\"form-group\">\n                                    <label for=\"regPassword\">Mot de passe</label>\n                                    <input\n                                        type=\"password\"\n                                        id=\"regPassword\"\n                                        placeholder=\"Au moins 8 caract\u00E8res\"\n                                        required\n                                    />\n                                </div>\n                                <button type=\"submit\" class=\"btn btn-primary\">\n                                    S'inscrire\n                                </button>\n                            </form>\n                        </div>\n                    </div>\n\n                    <div style=\"margin-top: 3rem; padding: 2rem; background-color: #e3f2fd; border-radius: 4px; border-left: 4px solid #0078d4;\">\n                        <h3 style=\"margin-top: 0; color: #000091;\">\u2139\uFE0F \u00C0 propos du service</h3>\n                        <p>\n                            Cette application de suivi oculaire clinique a \u00E9t\u00E9 d\u00E9velopp\u00E9e pour assister\n                            les professionnels de sant\u00E9 dans l'analyse pr\u00E9cise du suivi oculaire en orthoptie.\n                        </p>\n                        <p>\n                            Le service est s\u00E9curis\u00E9 et conforme aux normes gouvernementales de protection\n                            des donn\u00E9es personnelles.\n                        </p>\n                        <p style=\"margin-bottom: 0;\">\n                            <a href=\"#\" style=\"color: #000091; font-weight: 600;\">En savoir plus sur ce service \u2192</a>\n                        </p>\n                    </div>\n                </div>\n            </div>\n        `;\n    }\n\n    return `\n        <div class=\"screen home-screen authenticated\">\n            <div class=\"container\">\n                <h1>Bienvenue, ${state.patient?.firstName}</h1>\n                <p class=\"subtitle\">S\u00E9lectionnez une action pour commencer</p>\n\n                <div class=\"actions-grid\">\n                    <div class=\"action-card\" onclick=\"app.goToScreen('calibration-screen')\">\n                        <h3>\uD83C\uDFAF Nouvelle Calibration</h3>\n                        <p>Calibrer l'eye tracker pour une pr\u00E9cision optimale</p>\n                    </div>\n\n                    <div class=\"action-card\" onclick=\"app.goToScreen('test-screen')\">\n                        <h3>\uD83D\uDD0D Nouveau Test</h3>\n                        <p>Effectuer un test de suivi oculaire</p>\n                    </div>\n\n                    <div class=\"action-card\" onclick=\"app.goToScreen('results-screen')\">\n                        <h3>\uD83D\uDCCA Mes R\u00E9sultats</h3>\n                        <p>Consulter les tests pr\u00E9c\u00E9dents et l'analyse</p>\n                    </div>\n\n                    <div class=\"action-card\" onclick=\"app.goToScreen('statistics-screen')\">\n                        <h3>\uD83D\uDCC8 Statistiques</h3>\n                        <p>Visualiser les tendances et la progression</p>\n                    </div>\n                </div>\n\n                <div style=\"margin-top: 3rem; padding: 2rem; background-color: #f0f8f0; border-radius: 4px; border-left: 4px solid #27ae60;\">\n                    <h3 style=\"margin-top: 0; color: #000091;\">\u2713 Compte v\u00E9rifi\u00E9</h3>\n                    <p style=\"margin-bottom: 0;\">\n                        Vos donn\u00E9es sont prot\u00E9g\u00E9es et chiffr\u00E9es selon les standards gouvernementaux.\n                    </p>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * \u00C9cran de calibration DSFR\n */\nexport function renderCalibrationScreen(): string {\n    const state = stateManager.getState();\n    const calibrated = state.isCalibrated;\n\n    return `\n        <div class=\"screen calibration-screen\">\n            <div class=\"container\">\n                <h2>Calibration de l'Eye Tracker</h2>\n\n                <div class=\"calibration-instructions\">\n                    <p><strong>Instructions:</strong></p>\n                    <p>Veuillez suivre les points qui appara\u00EEtront \u00E0 l'\u00E9cran.</p>\n                    <p>Assurez-vous que votre cam\u00E9ra web est activ\u00E9e et que vous \u00EAtes bien positionn\u00E9 face \u00E0 l'\u00E9cran.</p>\n                    <p>Maintenez une position stable pendant la calibration.</p>\n                </div>\n\n                <div class=\"calibration-container\">\n                    <canvas id=\"calibrationCanvas\" width=\"800\" height=\"600\"></canvas>\n                </div>\n\n                <div class=\"calibration-status\">\n                    <p>\n                        Points de calibration: <strong>${state.calibrationPoints.length}/5</strong>\n                    </p>\n                    ${\n                        calibrated\n                            ? '<p class=\"success\">\u2713 Calibration r\u00E9ussie! Vous pouvez proc\u00E9der au test.</p>'\n                            : '<p>Veuillez calibrer au moins 5 points.</p>'\n                    }\n                </div>\n\n                <div class=\"button-group\">\n                    <button class=\"btn btn-primary\" id=\"startCalibration\" onclick=\"window.app.startCalibration()\">\n                        D\u00E9marrer la calibration\n                    </button>\n                    ${\n                        calibrated\n                            ? `<button class=\"btn btn-success\" onclick=\"app.goToScreen('test-screen')\">\n                        Continuer vers le test \u2192\n                    </button>`\n                            : ''\n                    }\n                    <button class=\"btn btn-secondary\" onclick=\"app.goToScreen('home-screen')\">\n                        Retour\n                    </button>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * \u00C9cran de test DSFR\n */\nexport function renderTestScreen(): string {\n    const state = stateManager.getState();\n    const testActive = !!state.currentTest;\n\n    return `\n        <div class=\"screen test-screen\">\n            <div class=\"container\">\n                <h2>Test de Suivi Oculaire</h2>\n\n                ${\n                    !state.isCalibrated\n                        ? `\n                    <div class=\"notification notification-warning\" style=\"margin-bottom: 2rem;\">\n                        <span>\u26A0\uFE0F Calibration requise avant de proc\u00E9der au test</span>\n                    </div>\n                `\n                        : ''\n                }\n\n                <div class=\"test-container\">\n                    <canvas id=\"testCanvas\" width=\"1024\" height=\"768\"></canvas>\n                </div>\n\n                ${\n                    testActive\n                        ? `\n                    <div class=\"test-stats\">\n                        <div class=\"stat\">\n                            <label>\u23F1\uFE0F Dur\u00E9e du test</label>\n                            <span id=\"testDuration\">0s</span>\n                        </div>\n                        <div class=\"stat\">\n                            <label>\uD83D\uDC41\uFE0F Suivi oculaire</label>\n                            <span id=\"testTracking\">0%</span>\n                        </div>\n                        <div class=\"stat\">\n                            <label>\uD83C\uDFAF Fixations</label>\n                            <span id=\"testFixations\">0</span>\n                        </div>\n                        <div class=\"stat\">\n                            <label>\uD83D\uDC40 \u00C9tat des yeux</label>\n                            <span id=\"testEyeState\">\u25CF\u25CF</span>\n                        </div>\n                        <div class=\"stat\">\n                            <label>\uD83D\uDCCA Stabilit\u00E9</label>\n                            <span id=\"testStability\">--</span>\n                        </div>\n                        <div class=\"stat\">\n                            <label>\uD83C\uDFAF Confiance</label>\n                            <span id=\"testConfidence\">--</span>\n                        </div>\n                    </div>\n                `\n                        : ''\n                }\n\n                <div class=\"button-group\">\n                    ${\n                        !testActive\n                            ? `<button class=\"btn btn-primary\" id=\"startTest\" onclick=\"window.app.startTest()\" ${!state.isCalibrated ? 'disabled' : ''}>\n                        D\u00E9marrer le test\n                    </button>`\n                            : `<button class=\"btn btn-danger\" id=\"stopTest\" onclick=\"window.app.stopTest()\">\n                        Arr\u00EAter le test\n                    </button>`\n                    }\n                    <button class=\"btn btn-secondary\" onclick=\"window.app.goToScreen('home-screen')\">\n                        Retour\n                    </button>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * \u00C9cran de r\u00E9sultats DSFR\n */\nexport function renderResultsScreen(): string {\n    const state = stateManager.getState();\n\n    return `\n        <div class=\"screen results-screen\">\n            <div class=\"container\">\n                <h2>R\u00E9sultats des Tests</h2>\n\n                ${\n                    state.testResults.length === 0\n                        ? `\n                    <div class=\"notification notification-info\">\n                        <span>Aucun test disponible. Commencez par effectuer un test.</span>\n                    </div>\n                `\n                        : `\n                    <div class=\"results-list\">\n                        ${state.testResults\n                            .map(\n                                (result: any, _index: number) => `\n                            <div class=\"result-card result-${result.result}\">\n                                <h3>Test #{} - ${new Date(result.test_date).toLocaleDateString(\n                                    'fr-FR'\n                                )}</h3>\n                                <p class=\"result-status ${result.result}\">\n                                    R\u00E9sultat: <strong>${\n                                        ({\n                                            excellent: 'Excellent',\n                                            good: 'Bon',\n                                            acceptable: 'Acceptable',\n                                            poor: 'Faible',\n                                        } as Record<string, string>)[result.result] || result.result.toUpperCase()\n                                    }</strong>\n                                </p>\n                                <div class=\"result-details\">\n                                    <p><strong>Dur\u00E9e:</strong> ${result.duration.toFixed(\n                                        1\n                                    )}s</p>\n                                    <p><strong>Suivi:</strong> ${result.tracking_percentage.toFixed(\n                                        1\n                                    )}%</p>\n                                    <p><strong>Fixations:</strong> ${\n                                        result.fixation_count\n                                    }</p>\n                                    <p><strong>Stab. gaze:</strong> ${result.gaze_stability.toFixed(\n                                        2\n                                    )}</p>\n                                </div>\n                            </div>\n                        `\n                            )\n                            .join('')}\n                    </div>\n                `\n                }\n\n                <div class=\"button-group\">\n                    <button class=\"btn btn-secondary\" onclick=\"app.goToScreen('home-screen')\">\n                        Retour\n                    </button>\n                </div>\n            </div>\n        </div>\n    `;\n}\n\n/**\n * \u00C9cran de statistiques DSFR\n */\nexport function renderStatisticsScreen(): string {\n    const state = stateManager.getState();\n    const stats = state.statistics;\n\n    return `\n        <div class=\"screen statistics-screen\">\n            <div class=\"container\">\n                <h2>Statistiques et Analyse</h2>\n\n                ${\n                    !stats\n                        ? `\n                    <div class=\"notification notification-info\">\n                        <span>Aucune statistique disponible. Effectuez des tests pour g\u00E9n\u00E9rer des statistiques.</span>\n                    </div>\n                `\n                        : `\n                    <div class=\"statistics-grid\">\n                        <div class=\"stat-card\">\n                            <h3>Tests effectu\u00E9s</h3>\n                            <p class=\"stat-value\">${stats.total_tests || 0}</p>\n                        </div>\n\n                        <div class=\"stat-card\">\n                            <h3>Suivi moyen</h3>\n                            <p class=\"stat-value\">${(stats.avg_tracking || 0).toFixed(\n                                1\n                            )}%</p>\n                        </div>\n\n                        <div class=\"stat-card\">\n                            <h3>Meilleur r\u00E9sultat</h3>\n                            <p class=\"stat-value\">${stats.best_result || '-'}</p>\n                        </div>\n\n                        <div class=\"stat-card\">\n                            <h3>Stabilit\u00E9 gaze</h3>\n                            <p class=\"stat-value\">${(stats.avg_stability || 0).toFixed(\n                                2\n                            )}</p>\n                        </div>\n                    </div>\n                `\n                }\n\n                <div class=\"button-group\">\n                    <button class=\"btn btn-secondary\" onclick=\"app.goToScreen('home-screen')\">\n                        Retour\n                    </button>\n                </div>\n            </div>\n        </div>\n    `;\n}\n"],
  "mappings": "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",
  "names": ["leftOpen", "rightOpen", "window", "pointElement", "app"]
}
